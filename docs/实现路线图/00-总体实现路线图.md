# WebVic3 总体实现路线图

## 文档说明

本文档是WebVic3项目的总体实现路线图，指导后续AI按照本路线图逐步实现整个游戏系统。本路线图基于以下文档编写：

- 总体策划文档
- 技术栈文档
- AI代码规范
- 六大分系统策划文档

**重要提示：**
- 本文档只包含接口定义和功能要求，不包含详细代码实现
- 每个阶段完成后必须进行完整的单元测试
- 单元测试通过并得到正确结果后，才能进入下一个开发阶段

---

## 项目概述

**WebVic3** 是一款基于Web的大型经济模拟策略游戏，核心玩法参考Paradox的《维多利亚3》，模拟从石器时代到AI时代的文明发展历程。

### 核心设计原则

1. **深度经济模拟**：真实模拟供需关系、生产链条、市场波动
2. **历史演进感**：体验人类文明从采集狩猎到AI时代的技术跃迁
3. **系统涌现**：各系统相互作用产生有趣的策略空间
4. **可理解性**：复杂系统需要清晰的UI呈现

### 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                        客户端层                              │
├─────────────────────────────────────────────────────────────┤
│  Vue3 UI层            ←─  Pinia状态管理                     │
│  - 页面组件                                                  │
│  - 状态展示                                                  │
│  - 用户交互                                                  │
├─────────────────────────────────────────────────────────────┤
│  游戏核心逻辑层 (Core) - 框架无关、平台无关                 │
│  - 经济系统                                                  │
│  - 生产系统                                                  │
│  - 人口系统                                                  │
│  - 科技系统                                                  │
│  - 地形地图系统                                              │
│  - 运输系统                                                  │
│  - 时间系统                                                  │
│  - 存档系统                                                  │
├─────────────────────────────────────────────────────────────┤
│                      通信层 (API)                           │
├─────────────────────────────────────────────────────────────┤
│  后端服务层                                                  │
│  - 定时数据持久化存储                                        │
│  - 用户认证与授权                                            │
│  - 存档管理                                                  │
└─────────────────────────────────────────────────────────────┘
```

---

## 实现阶段总览

| 阶段 | 名称 | 预计时间 | 交付物 | 依赖 | 测试要求 |
|------|------|----------|--------|------|----------|
| 阶段1 | 项目初始化 | 1周 | 项目骨架、开发环境 | - | 配置测试通过 |
| 阶段2 | 核心数据模型 | 1周 | 所有数据模型定义 | 阶段1 | 类型检查通过 |
| 阶段3 | 基础系统实现 | 2周 | 时间、存档、时代系统 | 阶段2 | 单元测试覆盖率>80% |
| 阶段4 | 高级系统实现 | 4周 | 六大核心系统 | 阶段3 | 单元测试覆盖率>80% |
| 阶段5 | UI层实现 | 3周 | 完整UI界面 | 阶段4 | 组件测试通过 |
| 阶段6 | 后端实现 | 2周 | 后端API服务 | 阶段5 | API测试通过 |

**总计：约15周**

---

## 测试标准与流程

### 测试要求

每个阶段完成后，必须完成以下测试：

1. **单元测试**
   - 所有核心函数和类必须有单元测试
   - 使用Jest作为测试框架
   - 测试覆盖率不低于80%

2. **类型检查**
   - 运行`pnpm typecheck`
   - 所有TypeScript类型错误必须修复

3. **代码检查**
   - 运行`pnpm lint`
   - 所有ESLint错误必须修复

### 测试流程

```
┌─────────────────────────────────────────────────────────┐
│ 1. 完成该阶段的功能实现                           │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│ 2. 编写单元测试                                   │
│    - 为每个公共函数编写测试                         │
│    - 覆盖正常情况和边界条件                         │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│ 3. 运行测试                                       │
│    - pnpm test                                       │
│    - 检查测试覆盖率                                 │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│ 4. 验证测试结果                                   │
│    - 所有测试必须通过                               │
│    - 覆盖率必须达到要求                           │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│ 5. 类型检查和代码检查                             │
│    - pnpm typecheck                                 │
│    - pnpm lint                                       │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│ 6. 确认所有检查通过，进入下一阶段                   │
└─────────────────────────────────────────────────────────┘
```

### 测试命令

```bash
# 运行所有测试
pnpm test

# 运行测试并查看覆盖率
pnpm test:coverage

# 类型检查
pnpm typecheck

# 代码检查
pnpm lint

# 代码检查并自动修复
pnpm lint:fix
```

---

## 阶段1：项目初始化

### 目标

搭建Monorepo项目结构，配置开发环境，建立基础代码规范。

### 任务清单

- [ ] 创建Monorepo项目结构
- [ ] 配置pnpm workspace
- [ ] 初始化Vue3前端项目
- [ ] 初始化Node.js后端项目
- [ ] 创建核心逻辑包
- [ ] 配置TypeScript
- [ ] 配置ESLint代码规范
- [ ] 配置Vite构建工具
- [ ] 编写项目README

### 接口要求

**项目结构要求：**
```
WebVic3/
├── apps/
│   ├── web/              # Vue3前端应用
│   │   ├── src/
│   │   │   ├── components/
│   │   │   ├── views/
│   │   │   ├── stores/
│   │   │   └── main.ts
│   │   ├── package.json
│   │   ├── vite.config.ts
│   │   └── tsconfig.json
│   └── server/           # Node.js后端应用
│       ├── src/
│       │   ├── routes/
│       │   ├── services/
│       │   └── index.ts
│       ├── package.json
│       └── tsconfig.json
├── packages/
│   └── core/             # 游戏核心逻辑（共享）
│       ├── src/
│       │   ├── systems/
│       │   ├── models/
│       │   ├── interfaces/
│       │   └── utils/
│       ├── package.json
│       └── tsconfig.json
├── pnpm-workspace.yaml
└── package.json
```

**package.json脚本要求：**
- `dev`：同时启动前端和后端
- `dev:web`：仅启动前端
- `dev:server`：仅启动后端
- `build`：构建所有包
- `typecheck`：类型检查
- `lint`：代码检查
- `test`：运行测试

### 单元测试要求

- [ ] 验证项目结构创建正确
- [ ] 验证pnpm workspace配置正确
- [ ] 运行`pnpm install`无错误
- [ ] 运行`pnpm dev`验证服务启动
- [ ] 运行`pnpm typecheck`通过
- [ ] 运行`pnpm lint`通过

### 进入下一阶段条件

✅ 所有任务清单完成
✅ 所有单元测试通过
✅ TypeScript类型检查通过
✅ ESLint代码检查通过

### 详细文档

详见：[阶段1-项目初始化.md](./阶段1-项目初始化.md)

---

## 阶段2：核心数据模型

### 目标

定义所有游戏系统的核心数据模型，建立类型系统。

### 任务清单

- [ ] 定义基础类型（时代、商品、建筑等）
- [ ] 定义商品模型（Goods）
- [ ] 定义建筑模型（Building）
- [ ] 定义生产方式模型（ProductionMethod）
- [ ] 定义市场模型（Market）
- [ ] 定义人口模型（Population）
- [ ] 定义科技模型（Technology）
- [ ] 定义地块模型（Tile）
- [ ] 定义运输模型（Transport）
- [ ] 定义游戏状态模型（GameState）

### 接口要求

**基础类型定义：**
- `Era`：枚举类型，包含石器时代到AI时代
- `BuildingType`：枚举类型，包含所有建筑类型
- `GoodsType`：枚举类型，包含原料、中间品、最终品等
- `AgeGroup`：枚举类型，包含儿童、青壮年、老年
- `EducationLevel`：枚举类型，包含文盲到研究生
- `SocialClass`：枚举类型，包含精英、中产、工人、贫民
- `TerrainType`：枚举类型，包含平原、森林、丘陵等

**商品模型接口：**
```typescript
interface Goods {
  id: string
  name: string
  type: GoodsType
  era: string
  basePrice: number
  priceHistory: PriceRecord[]
}
```

**建筑模型接口：**
```typescript
interface Building {
  id: string
  name: string
  type: BuildingType
  minEra: Era
  maxEra?: Era
  constructionCost: Record<string, number>
  constructionTime: number
  baseWorkers: number
  maxWorkers: number
  baseThroughput: number
  productionMethods: string[]
  level: number
  experience: number
  tileId: string
}
```

**市场模型接口：**
```typescript
interface Market {
  id: string
  name: string
  regions: string[]
  prices: Map<string, Price>
  supply: Map<string, number>
  demand: Map<string, number>
  stockpile: Map<string, number>
  events: MarketEvent[]
}
```

**人口模型接口：**
```typescript
interface Population {
  id: string
  tileId: string
  totalPopulation: number
  groups: PopulationGroup[]
  ageDistribution: {
    children: number
    adults: number
    elders: number
  }
  employment: {
    total: number
    employed: number
    unemployed: number
    retired: number
  }
  averageWage: number
  averageLivingStandard: number
}
```

**科技模型接口：**
```typescript
interface Technology {
  id: string
  name: string
  description: string
  era: Era
  prerequisites: string[]
  researchCost: number
  moneyCost: number
  goodsCost: Record<string, number>
  baseResearchTime: number
  unlocks: {
    buildings?: string[]
    productionMethods?: string[]
    goods?: string[]
    policies?: string[]
  }
  effects: TechEffect[]
}
```

**地块模型接口：**
```typescript
interface Tile {
  id: string
  name: string
  terrainComposition: Map<TerrainType, number>
  totalArea: number
  buildableArea: number
  usedArea: number
  resources: ResourceDeposit[]
  buildings: string[]
  isExplored: boolean
  isControlled: boolean
  controlCost: number
  roadLevel: number
  developmentLevel: number
  developmentExperience: number
}
```

### 单元测试要求

- [ ] 验证所有类型定义正确
- [ ] 验证所有接口属性完整
- [ ] 验证类型导出正确
- [ ] 运行`pnpm typecheck`无错误
- [ ] 运行`pnpm lint`无错误
- [ ] 测试覆盖率：N/A（仅类型定义）

### 进入下一阶段条件

✅ 所有任务清单完成
✅ TypeScript类型检查通过
✅ ESLint代码检查通过

### 详细文档

详见：[阶段2-核心数据模型.md](./阶段2-核心数据模型.md)

---

## 阶段3：基础系统实现

### 目标

实现游戏的基础支撑系统，为后续系统提供基础设施。

### 任务清单

- [ ] 实现时间系统
  - 游戏时间推进
  - Tick机制
  - 时间事件调度
- [ ] 实现时代系统
  - 时代晋升判断
  - 时代加成计算
  - 时代事件触发
- [ ] 实现存档系统
  - 状态序列化
  - 状态反序列化
  - 自动保存机制
- [ ] 实现事件系统
  - 事件发射器
  - 事件订阅
  - 事件队列
- [ ] 实现工具函数库
  - 数学计算函数
  - 随机数生成
  - 数据验证

### 接口要求

**时间管理器接口：**
```typescript
interface ITimeManager {
  advance(days: number): void
  getCurrentDate(): GameDate
  getTickCount(): number
  subscribe(listener: (date: GameDate) => void): () => void
}
```

**时代管理器接口：**
```typescript
interface IEraManager {
  getCurrentEra(): Era
  checkAdvancement(state: GameState): Era | null
  advanceTo(era: Era): void
  onEraChange(listener: (newEra: Era) => void): () => void
}
```

**存档序列化器接口：**
```typescript
interface ISaveSerializer {
  serialize(state: GameState): string
  deserialize(json: string): GameState
}
```

**事件发射器接口：**
```typescript
interface IGameEventEmitter {
  emit(event: GameEvent): void
  on(eventType: string, handler: EventHandler): void
  off(eventType: string, handler: EventHandler): void
}
```

**工具函数接口：**
- `clamp(value, min, max)`: 数值限制
- `lerp(a, b, t)`: 线性插值
- `mapRange(value, inMin, inMax, outMin, outMax)`: 范围映射
- `Random`类：随机数生成器
  - `next()`: 生成0-1随机数
  - `nextInt(min, max)`: 生成指定范围整数
  - `nextArrayItem(array)`: 随机选择数组元素
  - `weightedRandom(items)`: 按权重随机选择

### 单元测试要求

**时间系统测试：**
- [ ] 测试时间推进功能
- [ ] 测试月份进位逻辑
- [ ] 测试年份进位逻辑
- [ ] 测试订阅和取消订阅
- [ ] 测试Tick计数

**时代系统测试：**
- [ ] 测试时代晋升判断逻辑
- [ ] 测试时代条件验证
- [ ] 测试时代加成计算
- [ ] 测试时代变化事件触发

**存档系统测试：**
- [ ] 测试状态序列化
- [ ] 测试状态反序列化
- [ ] 测试Set和Map的序列化
- [ ] 测试循环引用处理

**事件系统测试：**
- [ ] 测试事件发射
- [ ] 测试事件订阅
- [ ] 测试事件取消订阅
- [ ] 测试多订阅者

**工具函数测试：**
- [ ] 测试clamp函数
- [ ] 测试lerp函数
- [ ] 测试mapRange函数
- [ ] 测试Random类所有方法
- [ ] 测试随机数分布

**测试覆盖率要求：**
- 代码覆盖率 > 80%
- 所有公共函数必须有测试

### 进入下一阶段条件

✅ 所有任务清单完成
✅ 所有单元测试通过
✅ 测试覆盖率 > 80%
✅ TypeScript类型检查通过
✅ ESLint代码检查通过

### 详细文档

详见：[阶段3-基础系统实现.md](./阶段3-基础系统实现.md)

---

## 阶段4：高级系统实现

### 目标

实现六大核心游戏系统。

### 4.1 生产系统

**任务清单：**
- [ ] 实现建筑管理
- [ ] 实现生产方式选择
- [ ] 实现生产计算
- [ ] 实现生产效率计算
- [ ] 实现资源枯竭机制
- [ ] 实现建筑升级系统

**接口要求：**
```typescript
interface IBuildingManager {
  createBuilding(configKey: string, tileId: string): Building
  getBuilding(id: string): Building | undefined
  getAllBuildings(): Building[]
  getBuildingsByTile(tileId: string): Building[]
  upgradeBuilding(buildingId: string): void
  removeBuilding(buildingId: string): void
  setProductionMethod(buildingId: string, methodId: string): void
}

interface IProductionCalculator {
  calculateProduction(
    building: Building,
    workers: number,
    era: Era,
    educationLevel: number,
    toolAvailability: number
  ): ProductionResult
  calculateUpgradeCost(building: Building): Record<string, number>
}
```

**单元测试要求：**
- [ ] 测试建筑创建
- [ ] 测试建筑升级
- [ ] 测试生产方式切换
- [ ] 测试生产计算
- [ ] 测试效率计算
- [ ] 测试资源枯竭
- 测试覆盖率 > 80%

### 4.2 市场与价格系统

**任务清单：**
- [ ] 实现市场管理
- [ ] 实现价格计算（瓦尔拉斯均衡）
- [ ] 实现供需计算
- [ ] 实现库存管理
- [ ] 实现市场事件系统
- [ ] 实现价格干预机制

**接口要求：**
```typescript
interface IMarketManager {
  updatePrices(date: GameDate): void
  addSupply(goodsId: string, amount: number): void
  addDemand(goodsId: string, amount: number): void
  getPrice(goodsId: string): number
  executeTransaction(goodsId: string, amount: number, isPurchase: boolean): number
  getMarket(): Market
}
```

**单元测试要求：**
- [ ] 测试价格更新逻辑
- [ ] 测试供需计算
- [ ] 测试价格调整函数
- [ ] 测试交易功能
- [ ] 测试库存管理
- [ ] 测试市场事件
- 测试覆盖率 > 80%

### 4.3 人口与就业系统

**任务清单：**
- [ ] 实现人口管理
- [ ] 实现人口增长模型
- [ ] 实现就业系统
- [ ] 实现工资计算
- [ ] 实现生活水平计算
- [ ] 实现需求满足计算
- [ ] 实现人口流动

**接口要求：**
```typescript
interface IPopulationManager {
  updateGrowth(date: GameDate): void
  calculateWages(marketPrices: Map<string, number>): void
  calculateLivingStandards(marketPrices: Map<string, number>): void
  getPopulation(id: string): Population | undefined
  getAllPopulations(): Population[]
}
```

**单元测试要求：**
- [ ] 测试人口增长计算
- [ ] 测试出生率和死亡率
- [ ] 测试工资计算
- [ ] 测试生活水平计算
- [ ] 测试需求满足计算
- [ ] 测试人口流动
- 测试覆盖率 > 80%

### 4.4 科技系统

**任务清单：**
- [ ] 实现科技树
- [ ] 实现研发系统
- [ ] 实现科技解锁机制
- [ ] 实现科技扩散
- [ ] 实现时代晋升系统
- [ ] 实现研发机构

**接口要求：**
```typescript
interface ITechnologyManager {
  addTechToQueue(techId: string): void
  canResearch(techId: string): boolean
  advanceResearch(days: number): void
  getAvailableTechs(): Technology[]
  getResearchedTechs(): Set<string>
  getResearchQueue(): ResearchQueue
}
```

**单元测试要求：**
- [ ] 测试科技解锁判断
- [ ] 测试研发队列
- [ ] 测试研发进度推进
- [ ] 测试科技完成
- [ ] 测试前置科技验证
- 测试覆盖率 > 80%

### 4.5 地形地图系统

**任务清单：**
- [ ] 实现地块生成
- [ ] 实现地形系统
- [ ] 实现资源矿床
- [ ] 实现领土扩张
- [ ] 实现地块开发度
- [ ] 实现地图探索

**接口要求：**
```typescript
interface ITileManager {
  generateInitialTile(): Tile
  generateNewTile(terrainType: string): Tile
  exploreTile(tileId: string): boolean
  controlTile(tileId: string): boolean
  getTile(id: string): Tile | undefined
  getAllTiles(): Tile[]
}
```

**单元测试要求：**
- [ ] 测试地块生成
- [ ] 测试地形组成
- [ ] 测试资源生成
- [ ] 测试地块探索
- [ ] 测试地块控制
- [ ] 测试可建设面积计算
- 测试覆盖率 > 80%

### 4.6 运输系统

**任务清单：**
- [ ] 实现运力计算
- [ ] 实现道路系统
- [ ] 实现运力需求
- [ ] 实现运力不足影响
- [ ] 实现运输工具演进
- [ ] 实现运力管理

**接口要求：**
```typescript
interface ITransportManager {
  updateTransportCapacity(tileId: string, buildings: Building[]): void
  calculateEfficiencyPenalties(tileId: string): Map<string, number>
  upgradeRoad(tileId: string): void
  getCapacity(tileId: string): TileTransportCapacity | undefined
}
```

**单元测试要求：**
- [ ] 测试运力计算
- [ ] 测试道路升级
- [ ] 测试运力需求计算
- [ ] 测试效率惩罚
- [ ] 测试优先级分配
- 测试覆盖率 > 80%

### 进入下一阶段条件

✅ 所有任务清单完成
✅ 所有单元测试通过
✅ 测试覆盖率 > 80%
✅ TypeScript类型检查通过
✅ ESLint代码检查通过

### 详细文档

详见：[阶段4-高级系统实现.md](./阶段4-高级系统实现.md)

---

## 阶段5：UI层实现

### 目标

实现完整的用户界面，提供良好的游戏体验。

### 任务清单

- [ ] 实现页面布局
  - 顶部导航栏
  - 侧边菜单
  - 主内容区
- [ ] 实现主仪表盘
  - 关键指标展示
  - 快速操作入口
  - 消息通知
- [ ] 实现地图界面
  - 地块展示
  - 地块交互
  - 地块详情面板
- [ ] 实现生产界面
  - 建筑列表
  - 建筑详情
  - 生产方式选择
- [ ] 实现市场界面
  - 市场总览
  - 商品详情
  - 价格图表
- [ ] 实现人口界面
  - 人口总览
  - 就业管理
  - 生活水平
- [ ] 实现科技界面
  - 科技树
  - 研发队列
  - 科技详情
- [ ] 实现设置界面
  - 游戏设置
  - 存档管理
- [ ] 实现数据可视化
  - 图表组件
  - 数据面板

### 组件要求

**布局组件：**
- `MainLayout`: 主布局容器
- `Sidebar`: 侧边导航栏
- `TopBar`: 顶部信息栏
- `StatItem`: 统计数据展示

**页面组件：**
- `Dashboard`: 游戏总览页面
- `Map`: 地图页面
- `Production`: 生产管理页面
- `Market`: 市场页面
- `Population`: 人口页面
- `Technology`: 科技页面
- `Settings`: 设置页面

**功能组件：**
- `StatCard`: 统计卡片
- `BuildingCard`: 建筑卡片
- `ResourceCard`: 资源卡片
- `Chart`: 图表组件

### 单元测试要求

**组件测试：**
- [ ] 测试布局组件渲染
- [ ] 测试导航组件路由
- [ ] 测试仪表盘数据展示
- [ ] 测试地图组件交互
- [ ] 测试生产列表渲染
- [ ] 测试市场数据展示
- [ ] 测试人口统计展示
- [ ] 测试科技树渲染
- [ ] 测试设置页面功能

**测试覆盖率要求：**
- 组件覆盖率 > 70%
- 所有交互功能必须有测试

### 进入下一阶段条件

✅ 所有任务清单完成
✅ 所有组件测试通过
✅ 测试覆盖率 > 70%
✅ TypeScript类型检查通过
✅ ESLint代码检查通过

### 详细文档

详见：[阶段5-UI层实现.md](./阶段5-UI层实现.md)

---

## 阶段6：后端实现

### 目标

实现后端API服务，提供数据持久化和用户管理。

### 任务清单

- [ ] 搭建Fastify服务器
- [ ] 实现用户认证
  - 用户注册
  - 用户登录
  - JWT认证
- [ ] 实现存档API
  - 保存存档
  - 加载存档
  - 列出存档
  - 删除存档
- [ ] 实现自动保存
  - 定时保存机制
  - 存档版本管理
- [ ] 实现数据库模型
  - 用户模型
  - 存档模型
- [ ] 配置MongoDB
- [ ] 实现API文档

### 接口要求

**用户API接口：**
```
POST /api/users/register - 用户注册
POST /api/users/login - 用户登录
GET /api/users/profile - 获取用户信息（需认证）
```

**存档API接口：**
```
POST /api/saves/save - 创建存档（需认证）
GET /api/saves/list - 获取存档列表（需认证）
GET /api/saves/:saveId - 获取存档详情（需认证）
PUT /api/saves/:saveId - 更新存档（需认证）
DELETE /api/saves/:saveId - 删除存档（需认证）
```

**健康检查接口：**
```
GET /api/health - 服务健康检查
```

### 单元测试要求

**API测试：**
- [ ] 测试用户注册
- [ ] 测试用户登录
- [ ] 测试JWT认证
- [ ] 测试存档创建
- [ ] 测试存档读取
- [ ] 测试存档更新
- [ ] 测试存档删除
- [ ] 测试存档列表
- [ ] 测试权限验证
- [ ] 测试错误处理

**数据库测试：**
- [ ] 测试数据库连接
- [ ] 测试用户模型CRUD
- [ ] 测试存档模型CRUD
- [ ] 测试索引功能

**测试覆盖率要求：**
- API覆盖率 > 80%
- 所有端点必须有测试

### 项目完成条件

✅ 所有任务清单完成
✅ 所有API测试通过
✅ 测试覆盖率 > 80%
✅ TypeScript类型检查通过
✅ ESLint代码检查通过
✅ API文档可访问

### 详细文档

详见：[阶段6-后端实现.md](./阶段6-后端实现.md)

---

## 核心设计原则

### 1. 核心逻辑独立

**原则：** 核心游戏逻辑必须与UI框架、平台完全独立。

**实现要求：**
- 核心逻辑包不依赖Vue/React等UI框架
- 核心逻辑不使用浏览器特有API（DOM、localStorage等）
- 核心逻辑可在浏览器、Node.js、Cocos Creator中运行
- 使用纯TypeScript编写核心逻辑

### 2. 类型安全

**原则：** 全面使用TypeScript类型系统，确保代码安全。

**实现要求：**
- 所有函数必须有明确的参数类型和返回类型
- 使用interface和type定义数据模型
- 使用enum定义常量
- 避免使用any类型

### 3. 纯函数优先

**原则：** 游戏计算逻辑使用纯函数，便于测试和复用。

**实现要求：**
- 计算函数不修改外部状态
- 相同输入必定得到相同输出
- 无副作用
- 便于单元测试

### 4. 接口抽象

**原则：** 通过接口层与UI框架解耦。

---

## 开发流程

### 1. 阅读文档

在每个阶段开始前，仔细阅读该阶段的详细文档。

### 2. 创建任务列表

根据详细文档中的任务清单，创建具体的实现任务。

### 3. 编写代码

- 按照代码规范编写代码
- 编写单元测试
- 确保类型检查通过
- 确保ESLint检查通过

### 4. 运行测试

```bash
# 运行单元测试
pnpm test

# 查看测试覆盖率
pnpm test:coverage

# 类型检查
pnpm typecheck

# 代码检查
pnpm lint
```

### 5. 验证结果

- 所有单元测试必须通过
- 测试覆盖率必须达到要求
- TypeScript类型检查必须通过
- ESLint代码检查必须通过

### 6. 进入下一阶段

只有当以上所有条件满足后，才能进入下一个开发阶段。

---

## 附录

### A. 技术栈版本

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.x | UI框架 |
| TypeScript | 5.x | 类型安全 |
| Vite | 5.x | 构建工具 |
| Pinia | latest | 状态管理 |
| Node.js | 20.x LTS | 运行时 |
| Fastify | 4.x | Web框架 |
| MongoDB | latest | 数据库 |
| pnpm | latest | 包管理器 |
| Jest | latest | 测试框架 |

### B. 参考文档

- 总体策划文档：`/Users/work/WebVic3/docs/总体策划文档.md`
- 技术栈文档：`/Users/work/WebVic3/docs/技术栈文档.md`
- AI代码规范：`/Users/work/WebVic3/docs/AI代码规范.md`
- 生产系统：`/Users/work/WebVic3/docs/分系统策划/生产系统.md`
- 市场与价格系统：`/Users/work/WebVic3/docs/分系统策划/市场与价格系统.md`
- 人口与就业系统：`/Users/work/WebVic3/docs/分系统策划/人口与就业系统.md`
- 科技系统：`/Users/work/WebVic3/docs/分系统策划/科技系统.md`
- 地形地图系统：`/Users/work/WebVic3/docs/分系统策划/地形地图系统.md`
- 运输系统：`/Users/work/WebVic3/docs/分系统策划/运输系统.md`

### C. 常用命令

```bash
# 安装依赖
pnpm install

# 启动开发环境
pnpm dev

# 运行类型检查
pnpm typecheck

# 运行代码检查
pnpm lint

# 修复代码问题
pnpm lint:fix

# 构建项目
pnpm build

# 运行测试
pnpm test

# 运行测试并查看覆盖率
pnpm test:coverage
```

---

## 更新日志

| 日期 | 版本 | 更新内容 |
|------|------|----------|
| 2026-02-23 | 1.0.0 | 初始版本，创建总体实现路线图 |
| 2026-02-23 | 1.1.0 | 移除详细代码，添加单元测试要求 |
