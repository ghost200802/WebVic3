# 阶段5.9：数据可视化

## 目标

实现数据可视化组件，提供图表展示和数据导出功能。

**重要提示：**
- 本文档只包含接口定义和功能要求，不包含详细代码实现
- 完成后必须进行单元测试
- 测试覆盖率 > 80% 才能进入下一阶段

---

## 任务清单

- [ ] 实现折线图组件
- [ ] 实现柱状图组件
- [ ] 实现饼图组件
- [ ] 实现面积图组件
- [ ] 实现图表配置功能
- [ ] 实现图表导出功能
- [ ] 编写单元测试

---

## 接口定义要求

### ChartData接口

```
interface ChartData {
  labels: string[]
  datasets: {
    label: string
    data: number[]
    color: string
  }[]
}
```

### ChartConfig接口

```
interface ChartConfig {
  type: 'line' | 'bar' | 'pie' | 'area'
  title: string
  xAxis?: string
  yAxis?: string
  legend?: boolean
  timeRange?: 'day' | 'week' | 'month' | 'year'
}
```

### ChartProps接口

```
interface ChartProps {
  data: ChartData
  config: ChartConfig
  onExport?: () => void
}
```

---

## 功能要求

### 图表类型

- 折线图：显示价格趋势、人口增长
- 柱状图：显示生产对比、收入支出对比
- 饼图：显示人口组成、资源分布
- 面积图：显示库存变化、产值变化

### 交互功能

- 悬停显示详细信息
- 缩放和平移图表
- 切换时间范围（日、周、月、年）
- 导出图表为图片
- 自定义图表配置
- 显示/隐藏图例
- 切换显示数据集

### 折线图功能

- 支持多条曲线
- 显示数据点标记
- 显示趋势线
- 支持渐变填充
- 响应式调整

### 柱状图功能

- 支持分组柱状图
- 支持堆叠柱状图
- 显示数值标签
- 支持横向/纵向布局

### 饼图功能

- 支持甜甜圈图模式
- 显示百分比标签
- 支持图例点击筛选
- 支持扇区展开

### 面积图功能

- 支持多区域堆叠
- 显示渐变填充
- 支持平滑曲线

### 图表配置

- 标题设置
- 轴标签设置
- 颜色主题选择
- 图例位置设置
- 动画开关

---

## 测试要求

### 图表测试

- [ ] 测试图表渲染
- [ ] 测试数据更新
- [ ] 测试交互功能（悬停、缩放）
- [ ] 测试导出功能
- [ ] 测试时间范围切换
- [ ] 测试图例交互
- [ ] 测试响应式布局
- [ ] 测试空数据处理

### 测试覆盖率要求

- 代码覆盖率 > 80%
- 所有公共组件必须有测试

---

## 实现文件

在 apps/web/src/components/charts/ 目录下创建以下文件：
- LineChart.vue - 折线图组件
- BarChart.vue - 柱状图组件
- PieChart.vue - 饼图组件
- AreaChart.vue - 面积图组件
- ChartContainer.vue - 图表容器组件
- index.ts - 导出文件

---

## 测试文件

创建以下测试文件：
- apps/web/src/components/charts/__tests__/LineChart.test.ts
- apps/web/src/components/charts/__tests__/BarChart.test.ts
- apps/web/src/components/charts/__tests__/PieChart.test.ts
- apps/web/src/components/charts/__tests__/AreaChart.test.ts
- apps/web/src/components/charts/__tests__/ChartContainer.test.ts

---

## 测试运行

运行单元测试命令：cd apps/web && pnpm test

运行覆盖率测试：cd apps/web && pnpm test:coverage

---

## 完成标准

### 功能实现完成

- [ ] 折线图组件实现完整
- [ ] 柱状图组件实现完整
- [ ] 饼图组件实现完整
- [ ] 面积图组件实现完整
- [ ] 图表配置功能实现完整
- [ ] 图表导出功能实现完整

### 文件创建完成

- [ ] LineChart.vue 创建完成
- [ ] BarChart.vue 创建完成
- [ ] PieChart.vue 创建完成
- [ ] AreaChart.vue 创建完成
- [ ] ChartContainer.vue 创建完成
- [ ] index.ts 创建完成

### 测试完成

- [ ] 所有单元测试通过
- [ ] 测试覆盖率 > 80%
- [ ] 所有公共组件有测试

### 代码检查完成

- [ ] pnpm typecheck 通过
- [ ] pnpm lint 通过
- [ ] 无TypeScript错误
- [ ] 无ESLint错误

---

## 进入下一阶段条件

✅ 所有任务清单完成
✅ 所有组件实现完整
✅ 所有单元测试通过
✅ 测试覆盖率 > 80%
✅ TypeScript类型检查通过
✅ ESLint代码检查通过

---

## 下一步

完成阶段5.9后，继续执行阶段5.10-状态管理

**重要提醒：** 确保所有测试通过且覆盖率达标后再进入下一阶段！
