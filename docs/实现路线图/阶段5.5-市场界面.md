# 阶段5.5：市场界面

## 目标

实现市场交易界面，展示价格、库存和交易功能。

**重要提示：**
- 本文档只包含接口定义和功能要求，不包含详细代码实现
- 完成后必须进行单元测试
- 测试覆盖率 > 80% 才能进入下一阶段

---

## 任务清单

- [ ] 实现市场视图组件
- [ ] 实现价格列表组件
- [ ] 实现交易面板组件
- [ ] 实现价格分析面板组件
- [ ] 实现价格趋势图表组件
- [ ] 编写单元测试

---

## 接口定义要求

### MarketViewProps接口

```
interface MarketViewProps {
  market: Market
  prices: Map<string, number>
  inventory: Map<string, number>
  onBuy: (goodsId: string, amount: number) => void
  onSell: (goodsId: string, amount: number) => void
}
```

### PriceListProps接口

```
interface PriceListProps {
  prices: Map<string, number>
  priceHistory: Map<string, number[]>
  selectedGoodsId: string | null
  onSelect: (goodsId: string) => void
}
```

### TradePanelProps接口

```
interface TradePanelProps {
  inventory: Map<string, number>
  prices: Map<string, number>
  selectedGoodsId: string | null
  onBuy: (amount: number) => void
  onSell: (amount: number) => void
}
```

### PriceAnalysisProps接口

```
interface PriceAnalysisProps {
  prices: Map<string, number>
  market: Market
}
```

---

## 功能要求

### 价格列表功能

- 显示所有商品价格
- 显示价格趋势（涨跌）
- 显示价格变化百分比
- 按商品类型筛选
- 支持搜索商品
- 高亮选中商品

### 交易面板

- 显示当前库存
- 显示商品价格
- 执行买入操作
- 执行卖出操作
- 显示交易成本
- 显示交易历史
- 支持数量调整
- 显示可交易数量限制

### 价格分析面板

- 显示供需关系
- 显示库存水平
- 显示价格预测
- 显示价格历史数据
- 显示市场事件影响

### 价格趋势图表

- 折线图显示价格历史
- 支持时间范围选择
- 支持多个商品对比
- 悬停显示详细信息

---

## 测试要求

### 市场界面测试

- [ ] 测试价格列表渲染
- [ ] 测试交易操作（买入/卖出）
- [ ] 测试价格图表
- [ ] 测试库存显示
- [ ] 测试价格趋势显示
- [ ] 测试搜索功能
- [ ] 测试筛选功能
- [ ] 测试交易历史

### 测试覆盖率要求

- 代码覆盖率 > 80%
- 所有公共组件必须有测试

---

## 实现文件

在 apps/web/src/components/market/ 目录下创建以下文件：
- MarketView.vue - 市场视图主组件
- PriceList.vue - 价格列表组件
- TradePanel.vue - 交易面板组件
- PriceAnalysis.vue - 价格分析面板组件
- PriceChart.vue - 价格趋势图表组件
- index.ts - 导出文件

---

## 测试文件

创建以下测试文件：
- apps/web/src/components/market/__tests__/MarketView.test.ts
- apps/web/src/components/market/__tests__/PriceList.test.ts
- apps/web/src/components/market/__tests__/TradePanel.test.ts
- apps/web/src/components/market/__tests__/PriceAnalysis.test.ts
- apps/web/src/components/market/__tests__/PriceChart.test.ts

---

## 测试运行

运行单元测试命令：cd apps/web && pnpm test

运行覆盖率测试：cd apps/web && pnpm test:coverage

---

## 完成标准

### 功能实现完成

- [ ] 市场视图组件实现完整
- [ ] 价格列表组件实现完整
- [ ] 交易面板组件实现完整
- [ ] 价格分析面板实现完整
- [ ] 价格趋势图表组件实现完整

### 文件创建完成

- [ ] MarketView.vue 创建完成
- [ ] PriceList.vue 创建完成
- [ ] TradePanel.vue 创建完成
- [ ] PriceAnalysis.vue 创建完成
- [ ] PriceChart.vue 创建完成
- [ ] index.ts 创建完成

### 测试完成

- [ ] 所有单元测试通过
- [ ] 测试覆盖率 > 80%
- [ ] 所有公共组件有测试

### 代码检查完成

- [ ] pnpm typecheck 通过
- [ ] pnpm lint 通过
- [ ] 无TypeScript错误
- [ ] 无ESLint错误

---

## 进入下一阶段条件

✅ 所有任务清单完成
✅ 所有组件实现完整
✅ 所有单元测试通过
✅ 测试覆盖率 > 80%
✅ TypeScript类型检查通过
✅ ESLint代码检查通过

---

## 下一步

完成阶段5.5后，继续执行阶段5.6-人口界面

**重要提醒：** 确保所有测试通过且覆盖率达标后再进入下一阶段！
