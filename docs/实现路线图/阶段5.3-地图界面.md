# 阶段5.3：地图界面

## 目标

实现游戏地图界面，展示地块、建筑和地形信息。

**重要提示：**
- 本文档只包含接口定义和功能要求，不包含详细代码实现
- 完成后必须进行单元测试
- 测试覆盖率 > 80% 才能进入下一阶段

---

## 任务清单

- [ ] 实现地图视图组件
- [ ] 实现地块渲染组件
- [ ] 实现地块信息面板组件
- [ ] 实现地图交互功能
- [ ] 编写单元测试

---

## 接口定义要求

### MapViewProps接口

```
interface MapViewProps {
  tiles: Map<string, Tile>
  buildings: Map<string, Building>
  selectedTileId: string | null
  onTileSelect: (tileId: string) => void
}
```

### TileInteraction接口

```
interface TileInteraction {
  type: 'select' | 'explore' | 'develop' | 'build'
  tileId: string
}
```

### TileComponentProps接口

```
interface TileComponentProps {
  tile: Tile
  buildings: Building[]
  isSelected: boolean
  onClick: () => void
}
```

### TileInfoPanelProps接口

```
interface TileInfoPanelProps {
  tile: Tile
  buildings: Building[]
  onClose: () => void
}
```

---

## 功能要求

### 地图显示功能

- 显示所有地块
- 显示地块地形组成
- 显示地块上的建筑
- 显示控制区域
- 显示可探索区域
- 支持缩放功能
- 支持平移功能

### 地图交互功能

- 点击选择地块
- 右键上下文菜单
- 拖拽平移地图
- 滚轮缩放地图
- 高亮选中地块

### 地块信息面板

- 显示地块基本信息（名称、ID）
- 显示地形组成及比例
- 显示地块上的建筑列表
- 显示资源矿床信息
- 显示开发度和开发经验
- 显示可建设面积
- 支持关闭面板

### 地块状态显示

- 已探索/未探索状态
- 已控制/未控制状态
- 建筑密度显示
- 资源丰富度显示

---

## 测试要求

### 地图测试

- [ ] 测试地图渲染
- [ ] 测试地块选择
- [ ] 测试缩放和平移
- [ ] 测试信息面板显示
- [ ] 测试性能（大量地块）
- [ ] 测试地块状态显示
- [ ] 测试交互事件

### 测试覆盖率要求

- 代码覆盖率 > 80%
- 所有公共组件必须有测试

---

## 实现文件

在 apps/web/src/components/map/ 目录下创建以下文件：
- MapView.vue - 地图视图主组件
- TileComponent.vue - 地块渲染组件
- TileInfoPanel.vue - 地块信息面板
- index.ts - 导出文件

---

## 测试文件

创建以下测试文件：
- apps/web/src/components/map/__tests__/MapView.test.ts
- apps/web/src/components/map/__tests__/TileComponent.test.ts
- apps/web/src/components/map/__tests__/TileInfoPanel.test.ts

---

## 测试运行

运行单元测试命令：cd apps/web && pnpm test

运行覆盖率测试：cd apps/web && pnpm test:coverage

---

## 完成标准

### 功能实现完成

- [ ] 地图视图组件实现完整
- [ ] 地块渲染组件实现完整
- [ ] 地块信息面板实现完整
- [ ] 地图交互功能实现完整

### 文件创建完成

- [ ] MapView.vue 创建完成
- [ ] TileComponent.vue 创建完成
- [ ] TileInfoPanel.vue 创建完成
- [ ] index.ts 创建完成

### 测试完成

- [ ] 所有单元测试通过
- [ ] 测试覆盖率 > 80%
- [ ] 所有公共组件有测试

### 代码检查完成

- [ ] pnpm typecheck 通过
- [ ] pnpm lint 通过
- [ ] 无TypeScript错误
- [ ] 无ESLint错误

---

## 进入下一阶段条件

✅ 所有任务清单完成
✅ 所有组件实现完整
✅ 所有单元测试通过
✅ 测试覆盖率 > 80%
✅ TypeScript类型检查通过
✅ ESLint代码检查通过

---

## 下一步

完成阶段5.3后，继续执行阶段5.4-生产界面

**重要提醒：** 确保所有测试通过且覆盖率达标后再进入下一阶段！
