# 阶段4.3：人口与就业系统

## 目标

实现人口管理、人口增长模型、就业系统、工资计算、生活水平计算、需求满足计算和人口流动。

**重要提示：**
- 本文档只包含接口定义和功能要求，不包含详细代码实现
- 完成后必须进行单元测试
- 测试覆盖率 > 80% 才能进入下一阶段

---

## 任务清单

- [ ] 实现人口管理
- [ ] 实现人口增长模型
- [ ] 实现就业系统
- [ ] 实现工资计算
- [ ] 实现生活水平计算
- [ ] 实现需求满足计算
- [ ] 实现人口流动

---

## 接口定义要求

### IPopulationManager接口

```typescript
interface IPopulationManager {
  updateGrowth(date: GameDate): void
  calculateWages(marketPrices: Map<string, number>): void
  calculateLivingStandards(marketPrices: Map<string, number>): void
  getPopulation(id: string): Population | undefined
  getAllPopulations(): Population[]
  assignWorker(populationId: string, buildingId: string): void
  removeWorker(populationId: string): void
}
```

### IWageCalculator接口

```typescript
interface IWageCalculator {
  calculateWage(
    worker: PopulationGroup,
    building: Building,
    marketPrices: Map<string, number>
  ): number
}
```

### ILivingStandardCalculator接口

```typescript
interface ILivingStandardCalculator {
  calculateLivingStandard(
    population: PopulationGroup,
    marketPrices: Map<string, number>
  ): number
  calculateNeedSatisfaction(
    population: PopulationGroup,
    marketPrices: Map<string, number>
  ): {
    survival: number
    basic: number
    improved: number
    luxury: number
  }
}
```

---

## 功能要求

### 人口增长模型

- 基于生活水平计算出生率
- 基于生活水平计算死亡率
- 考虑年龄分布
- 考虑移民因素

### 就业系统

- 分配工人到建筑
- 计算失业率
- 管理退休人员
- 处理解雇

### 工资计算

- 基于建筑类型计算基础工资
- 考虑工人技能
- 考虑教育水平
- 考虑商品价格（实际购买力）

### 生活水平计算

- 基于工资和物价计算
- 考虑需求满足度
- 生存需求、基本需求、改善需求、奢侈品需求

---

## 测试要求

### 人口系统测试

- [ ] 测试人口增长计算
- [ ] 测试出生率和死亡率
- [ ] 测试工资计算
- [ ] 测试生活水平计算
- [ ] 测试需求满足计算
- [ ] 测试人口流动
- [ ] 测试就业分配

### 测试覆盖率要求

- 代码覆盖率 > 80%
- 所有公共方法必须有测试

---

## 实现文件

在 `packages/core/src/systems/population/` 目录下创建以下文件：

- `populationManager.ts` - 人口管理器
- `wageCalculator.ts` - 工资计算器
- `livingStandardCalculator.ts` - 生活水平计算器
- `index.ts` - 导出文件

---

## 测试文件

创建以下测试文件：

- `packages/core/src/systems/population/__tests__/populationManager.test.ts`
- `packages/core/src/systems/population/__tests__/wageCalculator.test.ts`
- `packages/core/src/systems/population/__tests__/livingStandardCalculator.test.ts`

---

## 测试运行

```bash
cd packages/core
pnpm test
```

### 测试覆盖率

```bash
cd packages/core
pnpm test:coverage
```

---

## 完成标准

### 功能实现完成

- [ ] 人口增长模型实现完整
- [ ] 就业系统实现完整
- [ ] 工资计算功能实现完整
- [ ] 生活水平计算功能实现完整

### 文件创建完成

- [ ] populationManager.ts 创建完成
- [ ] wageCalculator.ts 创建完成
- [ ] livingStandardCalculator.ts 创建完成
- [ ] index.ts 创建完成

### 测试完成

- [ ] 所有单元测试通过
- [ ] 测试覆盖率 > 80%
- [ ] 所有公共函数/方法有测试

### 代码检查完成

- [ ] `pnpm typecheck` 通过
- [ ] `pnpm lint` 通过
- [ ] 无TypeScript错误
- [ ] 无ESLint错误

---

## 进入下一阶段条件

✅ 所有任务清单完成
✅ 所有功能实现完整
✅ 所有单元测试通过
✅ 测试覆盖率 > 80%
✅ TypeScript类型检查通过
✅ ESLint代码检查通过

---

## 下一步

完成阶段4.3后，继续执行[阶段4.4-科技系统](./阶段4.4-科技系统.md)

**重要提醒：** 确保所有测试通过且覆盖率达标后再进入下一阶段！
