# 阶段5.4：生产界面

## 目标

实现生产管理界面，展示建筑列表、生产方式和建设功能。

**重要提示：**
- 本文档只包含接口定义和功能要求，不包含详细代码实现
- 完成后必须进行单元测试
- 测试覆盖率 > 80% 才能进入下一阶段

---

## 任务清单

- [ ] 实现生产视图组件
- [ ] 实现建筑列表组件
- [ ] 实现建筑详情面板组件
- [ ] 实现建设面板组件
- [ ] 实现生产方式切换功能
- [ ] 编写单元测试

---

## 接口定义要求

### ProductionViewProps接口

```
interface ProductionViewProps {
  buildings: Building[]
  population: Population[]
  marketPrices: Map<string, number>
  onBuild: (configKey: string, tileId: string) => void
  onUpgrade: (buildingId: string) => void
  onChangeMethod: (buildingId: string, methodId: string) => void
}
```

### BuildingListProps接口

```
interface BuildingListProps {
  buildings: ExtendedBuilding[]
  selectedBuildingId: string | null
  onSelect: (buildingId: string) => void
}
```

### BuildingDetailProps接口

```
interface BuildingDetailProps {
  building: ExtendedBuilding
  availableMethods: ProductionMethod[]
  onUpgrade: () => void
  onChangeMethod: (methodId: string) => void
}
```

### BuildPanelProps接口

```
interface BuildPanelProps {
  availableBuildings: BuildingConfig[]
  marketPrices: Map<string, number>
  onBuild: (configKey: string) => void
}
```

---

## 功能要求

### 建筑列表功能

- 显示所有建筑（支持堆叠显示）
- 按建筑类型筛选
- 按地块筛选
- 显示建筑状态（运行中/暂停）
- 显示生产效率
- 显示工人数量
- 显示建筑等级
- 支持选中建筑

### 建筑详情面板

- 显示建筑基本信息（名称、类型、等级）
- 显示当前生产方式
- 切换生产方式（显示可用方式列表）
- 显示产出（根据生产方式）
- 显示消耗（根据生产方式）
- 显示效率计算
- 显示升级成本
- 显示建筑经验
- 支持升级建筑

### 建设面板

- 显示可用建筑列表
- 显示建筑成本
- 显示前置条件（时代、科技）
- 显示可建设位置
- 预览建筑效果
- 支持筛选建筑类型

### 生产方式功能

- 显示建筑支持的生产方式
- 显示生产方式解锁状态
- 显示生产方式投入产出
- 显示生产方式效率
- 支持切换生产方式
- 显示当前选中方式

---

## 测试要求

### 生产界面测试

- [ ] 测试建筑列表渲染
- [ ] 测试建筑筛选
- [ ] 测试建筑详情显示
- [ ] 测试建设面板
- [ ] 测试生产方式切换
- [ ] 测试建筑堆叠显示
- [ ] 测试升级功能
- [ ] 测试成本计算

### 测试覆盖率要求

- 代码覆盖率 > 80%
- 所有公共组件必须有测试

---

## 实现文件

在 apps/web/src/components/production/ 目录下创建以下文件：
- ProductionView.vue - 生产视图主组件
- BuildingList.vue - 建筑列表组件
- BuildingDetail.vue - 建筑详情组件
- BuildPanel.vue - 建设面板组件
- ProductionMethodSelect.vue - 生产方式选择组件
- index.ts - 导出文件

---

## 测试文件

创建以下测试文件：
- apps/web/src/components/production/__tests__/ProductionView.test.ts
- apps/web/src/components/production/__tests__/BuildingList.test.ts
- apps/web/src/components/production/__tests__/BuildingDetail.test.ts
- apps/web/src/components/production/__tests__/BuildPanel.test.ts

---

## 测试运行

运行单元测试命令：cd apps/web && pnpm test

运行覆盖率测试：cd apps/web && pnpm test:coverage

---

## 完成标准

### 功能实现完成

- [ ] 生产视图组件实现完整
- [ ] 建筑列表组件实现完整
- [ ] 建筑详情面板实现完整
- [ ] 建设面板实现完整
- [ ] 生产方式切换功能实现完整

### 文件创建完成

- [ ] ProductionView.vue 创建完成
- [ ] BuildingList.vue 创建完成
- [ ] BuildingDetail.vue 创建完成
- [ ] BuildPanel.vue 创建完成
- [ ] ProductionMethodSelect.vue 创建完成
- [ ] index.ts 创建完成

### 测试完成

- [ ] 所有单元测试通过
- [ ] 测试覆盖率 > 80%
- [ ] 所有公共组件有测试

### 代码检查完成

- [ ] pnpm typecheck 通过
- [ ] pnpm lint 通过
- [ ] 无TypeScript错误
- [ ] 无ESLint错误

---

## 进入下一阶段条件

✅ 所有任务清单完成
✅ 所有组件实现完整
✅ 所有单元测试通过
✅ 测试覆盖率 > 80%
✅ TypeScript类型检查通过
✅ ESLint代码检查通过

---

## 下一步

完成阶段5.4后，继续执行阶段5.5-市场界面

**重要提醒：** 确保所有测试通过且覆盖率达标后再进入下一阶段！
