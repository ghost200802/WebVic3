# 运输系统策划文档

## 1. 系统概述

运输系统负责管理地块内的运力资源。运力是支持地块内生产活动的基础设施资源，不同类型的建筑和生产方式对运力有不同的需求。当运力不足时，地块内的生产效率会受到影响。

---

## 2. 核心概念

### 2.1 地块运力（Tile Transport Capacity）

```typescript
interface TileTransportCapacity {
  tileId: string;
  
  // 运力总量
  maxCapacity: number;          // 运力上限（由道路等级决定）
  usedCapacity: number;         // 已使用运力
  availableCapacity: number;    // 可用运力
  
  // 运力来源（由时代和基础设施决定）
  sources: {
    human: number;              // 人力运输
    animal: number;             // 牲畜运输
    vehicle: number;            // 车辆运输
    mechanical: number;         // 机械运输
  };
  
  // 道路等级
  roadLevel: number;
}
```

### 2.2 运力需求（Transport Demand）

```typescript
interface TransportDemand {
  // 建筑运力需求
  buildingDemands: Map<BuildingId, {
    baseDemand: number;         // 基础运力需求
    actualDemand: number;       // 实际需求（受生产方式影响）
    priority: DemandPriority;   // 需求优先级
  }>;
  
  // 总需求
  totalDemand: number;
  
  // 需求满足率
  satisfactionRate: number;     // 0-1
}

enum DemandPriority {
  CRITICAL = 'critical',        // 关键（食物生产）
  HIGH = 'high',                // 高（原材料生产）
  NORMAL = 'normal',            // 普通（一般生产）
  LOW = 'low',                  // 低（奢侈品生产）
}
```

### 2.3 运力不足影响

```typescript
interface TransportShortageEffect {
  // 效率惩罚
  efficiencyPenalty: number;    // 0-1，生产效率下降比例
  
  // 分建筑影响
  buildingEffects: Map<BuildingId, {
    penalty: number;            // 该建筑的效率惩罚
    isShutdown: boolean;        // 是否停工
  }>;
  
  // 计算公式
  // penalty = max(0, (demand - capacity) / demand) * severityFactor
}
```

---

## 3. 道路系统

### 3.1 道路等级

道路等级决定地块的运力上限，是运输系统的核心基础设施。

```typescript
interface RoadLevel {
  level: number;
  name: string;
  
  // 运力上限
  capacityBonus: number;        // 基础运力加成
  
  // 效果
  speedModifier: number;        // 运输速度加成
  maintenanceCost: number;      // 维护成本
  
  // 建设条件
  requiredTech: TechId;
  constructionCost: number;     // 建造成本
  constructionTime: number;     // 建造时间（天）
}
```

### 3.2 道路等级表

| 等级 | 名称 | 运力上限 | 速度加成 | 维护成本 | 解锁科技 | 建造成本 |
|------|------|----------|----------|----------|----------|----------|
| 0 | 无道路 | 100 | 1.0x | 0 | - | - |
| 1 | 土路 | 150 | 1.1x | 5 | 石器制作 | 100 |
| 2 | 石子路 | 220 | 1.2x | 10 | 建筑学 | 300 |
| 3 | 石板路 | 320 | 1.4x | 20 | 道路建设 | 800 |
| 4 | 驿道 | 480 | 1.6x | 35 | 驿道系统 | 2000 |
| 5 | 碎石公路 | 700 | 1.8x | 50 | 工程学 | 5000 |
| 6 | 柏油路 | 1000 | 2.0x | 80 | 石油化工 | 12000 |
| 7 | 高速公路 | 1500 | 2.5x | 120 | 现代工程 | 30000 |
| 8 | 智能道路 | 2200 | 3.0x | 100 | AI时代 | 60000 |

### 3.3 道路建设

```typescript
interface RoadConstruction {
  tileId: string;
  targetLevel: number;
  
  // 建设成本
  cost: {
    money: number;
    labor: number;
    materials: Map<GoodsId, number>;
  };
  
  // 建设时间
  constructionTime: number;
  
  // 建设条件
  requirements: {
    currentLevel: number;       // 当前道路等级
    requiredTech: TechId;
    minTileDevelopment: number; // 地块开发度要求
  };
}
```

---

## 4. 运力需求设计

### 4.1 建筑类型运力需求

不同类型的建筑有不同的基础运力需求：

| 建筑类型 | 基础运力需求 | 说明 |
|----------|--------------|------|
| 农田 | 5 | 农产品运输 |
| 牧场 | 8 | 畜牧产品运输 |
| 林场 | 10 | 木材运输 |
| 渔场 | 6 | 水产品运输 |
| 矿场 | 20 | 矿石运输（重型） |
| 采石场 | 15 | 石材运输 |
| 作坊 | 12 | 原料和成品运输 |
| 工场 | 25 | 大规模生产运输 |
| 工厂 | 40 | 工业化生产运输 |
| 现代工厂 | 60 | 高产量运输需求 |
| 仓库 | 3 | 基础仓储运输 |
| 大型仓库 | 8 | 大规模仓储运输 |
| 市场 | 10 | 商品流通运输 |
| 港口 | 30 | 水运集散 |
| 火车站 | 50 | 铁路集散 |
| 机场 | 40 | 航空集散 |

### 4.2 生产方式运力修正

不同的生产方式会对基础运力需求进行修正：

| 生产方式 | 运力修正 | 说明 |
|----------|----------|------|
| 手工生产 | 1.0x | 基准 |
| 分工生产 | 1.2x | 原料种类增加 |
| 机械化生产 | 1.5x | 产量提升，运输增加 |
| 流水线生产 | 2.0x | 大规模生产 |
| 自动化生产 | 2.5x | 高产量需求 |
| 智能生产 | 3.0x | 超大规模生产 |

### 4.3 运力需求计算示例

```
建筑运力需求 = 基础需求 × 生产方式修正 × 规模系数

示例：
- 铁器时代矿场（基础20）× 分工生产（1.2x）× 规模2 = 48 运力需求
- 工业时代工厂（基础40）× 机械化生产（1.5x）× 规模1 = 60 运力需求
```

---

## 5. 运力不足影响

### 5.1 效率惩罚机制

当地块运力不足时，按优先级顺序影响生产效率：

```typescript
function calculateEfficiencyPenalty(
  capacity: TileTransportCapacity,
  demands: TransportDemand
): Map<BuildingId, number> {
  const penalties = new Map();
  let remainingCapacity = capacity.availableCapacity;
  
  // 按优先级排序需求
  const sortedDemands = sortByPriority(demands.buildingDemands);
  
  for (const [buildingId, demand] of sortedDemands) {
    if (remainingCapacity >= demand.actualDemand) {
      penalties.set(buildingId, 0);
      remainingCapacity -= demand.actualDemand;
    } else {
      const shortage = demand.actualDemand - remainingCapacity;
      const penalty = shortage / demand.actualDemand;
      penalties.set(buildingId, penalty);
      remainingCapacity = 0;
    }
  }
  
  return penalties;
}
```

### 5.2 效率惩罚表

| 运力满足率 | 效率惩罚 | 生产影响 |
|------------|----------|----------|
| 100% | 0% | 正常生产 |
| 90-99% | 5-10% | 轻微影响 |
| 70-89% | 15-30% | 明显下降 |
| 50-69% | 35-50% | 严重影响 |
| 30-49% | 55-70% | 接近停工 |
| <30% | 80-100% | 基本停工 |

### 5.3 优先级分配

当运力不足时，按以下优先级分配运力：

1. **关键优先级**：食物生产建筑（农田、渔场、牧场）
2. **高优先级**：原材料生产（矿场、林场、采石场）
3. **普通优先级**：加工生产（作坊、工场、工厂）
4. **低优先级**：奢侈品生产、非必要建筑

---

## 6. 运输工具演进

运输工具决定地块的基础运力来源，随时代解锁更高效的运输方式。

### 6.1 运输工具类型

| 时代 | 运输方式 | 基础运力贡献 | 解锁条件 |
|------|----------|--------------|----------|
| 石器 | 人力背负 | +10 | - |
| 石器 | 简易担架 | +15 | 原始社会 |
| 青铜 | 牲畜驮运 | +30 | 畜牧驯化 |
| 青铜 | 简易拖车 | +50 | 车轮发明 |
| 铁器 | 畜力车 | +80 | 道路建设 |
| 古典 | 四轮马车 | +120 | 驿道系统 |
| 中世纪 | 大型货车 | +180 | 马具改进 |
| 文艺复兴 | 驿站网络 | +250 | 驿站制度 |
| 工业 | 蒸汽动力 | +400 | 蒸汽机 |
| 电气 | 内燃卡车 | +600 | 内燃机 |
| 信息 | 现代物流 | +1000 | 现代物流 |
| AI | 智能运输 | +1500 | AI时代 |

### 6.2 运输工具投资

玩家可以投资运输工具来提升地块运力：

```typescript
interface TransportInvestment {
  tileId: string;
  
  // 投资类型
  type: TransportType;
  
  // 投资成本
  cost: {
    money: number;
    materials: Map<GoodsId, number>;
  };
  
  // 效果
  capacityIncrease: number;     // 运力增加量
  maintenanceCost: number;      // 新增维护成本
  
  // 解锁条件
  requirements: {
    requiredTech: TechId;
    minRoadLevel: number;       // 最低道路等级要求
  };
}
```

---

## 7. 运力管理界面

### 7.1 地块运力总览

```
┌─────────────────────────────────────────────────────────────┐
│ 🚚 地块运力总览 - 王都地块                                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ ─── 运力概况 ──────────────────────────────────────────     │
│ 运力上限:    480 (驿道 Lv.4)                                │
│ 已使用:      425                                            │
│ 可用运力:    55 (11%)                                       │
│                                                             │
│ ████████████████████████████████████████████░░░░░░ 89%     │
│                                                             │
│ ─── 运力来源 ──────────────────────────────────────────     │
│ 🐎 牲畜运输    120  ████████░░░░░░░░░░░░░░░░░░░░░░         │
│ 🚗 车辆运输    200  ████████████████░░░░░░░░░░░░░░         │
│ 📦 基础运力    160  ████████████░░░░░░░░░░░░░░░░░░         │
│                                                             │
│ ─── 运力需求 ──────────────────────────────────────────     │
│ 建筑          需求    优先级    状态                         │
│ 农田×3        45      关键      ✓ 满足                       │
│ 矿场×1        48      高        ✓ 满足                       │
│ 作坊×2        60      普通      ✓ 满足                       │
│ 工场×1        50      普通      ✓ 满足                       │
│ 市场×1        10      低        ✓ 满足                       │
│ 仓库×2        16      低        ✓ 满足                       │
│ ────────────────────────────────────────────────────────    │
│ 总需求: 425    满足率: 100%                                  │
│                                                             │
│ [升级道路]  [投资运输]  [调整优先级]                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 运力不足警告

```
┌─────────────────────────────────────────────────────────────┐
│ ⚠️ 运力不足警告 - 北境地块                                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 运力上限: 220    总需求: 310    缺口: 90 (29%)              │
│                                                             │
│ ─── 受影响建筑 ──────────────────────────────────────────   │
│ 建筑          需求    分配    效率惩罚                       │
│ 农田×2        30      30      0% (关键优先)                 │
│ 矿场×1        48      48      0% (高优先)                   │
│ 作坊×3        90      72      -20% ⚠️                       │
│ 工场×1        50      30      -40% 🔴                       │
│ 市场×1        10      0       -100% (停工) ❌               │
│                                                             │
│ ─── 建议措施 ──────────────────────────────────────────     │
│ • 升级道路至石板路 (+100运力)                               │
│ • 投资10辆畜力车 (+80运力)                                  │
│ • 暂停市场运营，节省10运力                                  │
│                                                             │
│ [升级道路]  [投资运输]  [调整生产]                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 8. 数值平衡

### 8.1 运力增长曲线

| 时代 | 道路等级 | 道路运力 | 运输工具运力 | 总运力潜力 |
|------|----------|----------|--------------|------------|
| 石器 | 1 | 150 | 25 | 175 |
| 青铜 | 2 | 220 | 80 | 300 |
| 铁器 | 3 | 320 | 200 | 520 |
| 古典 | 4 | 480 | 370 | 850 |
| 中世纪 | 4 | 480 | 550 | 1030 |
| 文艺复兴 | 5 | 700 | 800 | 1500 |
| 工业 | 5 | 700 | 1200 | 1900 |
| 电气 | 6 | 1000 | 1800 | 2800 |
| 信息 | 7 | 1500 | 2800 | 4300 |
| AI | 8 | 2200 | 4300 | 6500 |

### 8.2 运力需求增长

| 时代 | 典型建筑组合 | 总运力需求 | 道路等级建议 |
|------|--------------|------------|--------------|
| 石器 | 农田×2, 林场×1 | 40 | 土路 |
| 青铜 | 农田×3, 矿场×1, 作坊×1 | 95 | 石子路 |
| 铁器 | 农田×4, 矿场×2, 作坊×2 | 180 | 石板路 |
| 古典 | 农田×5, 矿场×2, 工场×1 | 280 | 驿道 |
| 中世纪 | 农田×6, 矿场×3, 工场×2 | 420 | 驿道 |
| 文艺复兴 | 农田×8, 矿场×3, 工场×3 | 580 | 碎石公路 |
| 工业 | 农田×10, 矿场×4, 工厂×2 | 850 | 碎石公路 |
| 电气 | 农田×12, 矿场×5, 工厂×4 | 1200 | 柏油路 |
| 信息 | 现代农业, 矿场×6, 工厂×6 | 2000 | 高速公路 |
| AI | 智能农业, 矿场×8, 工厂×8 | 3500 | 智能道路 |

---

## 9. 特殊机制

### 9.1 地形运力修正

不同地形对运力有天然影响：

| 地形 | 运力修正 | 说明 |
|------|----------|------|
| 平原 | 1.0x | 基准 |
| 森林 | 0.9x | 道路建设困难 |
| 丘陵 | 0.85x | 地形起伏 |
| 沙漠 | 0.8x | 沙地通行困难 |
| 冰雪 | 0.7x | 极端条件 |
| 沼泽 | 0.6x | 需要特殊道路 |

### 9.2 季节运力修正

| 季节 | 运力修正 | 说明 |
|------|----------|------|
| 春季 | 1.0x | 正常 |
| 夏季 | 0.95x | 高温影响 |
| 秋季 | 1.05x | 最佳运输季节 |
| 冬季 | 0.8x | 寒冷天气影响 |

### 9.3 科技加成

特定科技可以提升运力效率：

| 科技 | 效果 | 时代 |
|------|------|------|
| 车轮发明 | 运输效率+10% | 青铜 |
| 道路建设 | 道路运力+15% | 铁器 |
| 驿道系统 | 运输效率+15% | 古典 |
| 马具改进 | 牲畜运力+20% | 中世纪 |
| 蒸汽机 | 机械运力解锁 | 工业 |
| 内燃机 | 车辆运力+30% | 电气 |
| 现代物流 | 运输效率+25% | 信息 |
| AI调度 | 运输效率+40% | AI |

---

## 10. 设计要点总结

### 10.1 核心设计原则

1. **简化物流**：移除跨地块运输，运力仅影响地块内生产
2. **基础设施投资**：道路建设是提升运力的主要途径
3. **生产约束**：运力不足成为生产扩张的自然限制
4. **优先级管理**：玩家需要决策哪些生产优先保障

### 10.2 玩家决策点

- 是否升级道路以支持更多生产建筑
- 如何分配有限的运力资源
- 是否投资运输工具提升运力
- 在运力不足时优先保障哪些生产

### 10.3 系统交互

- **生产系统**：运力直接影响生产效率
- **建设系统**：道路建设需要资源和时间
- **科技系统**：解锁更高级的道路和运输工具
- **经济系统**：运力投资需要资金和材料
