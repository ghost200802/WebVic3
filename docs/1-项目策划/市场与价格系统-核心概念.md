# 市场与价格系统 - 核心概念

## 系统概述

市场与价格系统模拟复杂的市场经济机制，处理商品定价、供需关系、价格波动、贸易和市场事件。系统通过动态定价机制反映真实市场规律，为玩家提供丰富的经济决策。

---

## 核心概念

### 市场（Market）

市场是商品交换的场所，统一管理所有商品的买卖活动。

#### 市场基本属性

```typescript
interface Market {
  id: string
  name: string

  goods: Map<string, Goods>

  priceHistory: Map<string, PriceRecord[]>
  demandHistory: Map<string, DemandRecord[]>
  supplyHistory: Map<string, SupplyRecord[]>

  tariffs: Record<string, number>

  marketEvents: MarketEvent[]
}
```

#### 市场功能

- 商品交易
- 价格形成
- 供需平衡
- 贸易管理
- 事件处理

---

### 商品（Goods）

商品是市场交易的基本单位。

#### 商品基本属性

```typescript
interface Goods {
  id: string
  name: string
  type: GoodsType

  era: Era
  rarity: number

  basePrice: number
  currentPrice: number

  priceHistory: PriceRecord[]

  demand: number
  supply: number

  demandElasticity: number
  supplyElasticity: number

  storageRequired: boolean
  transportable: boolean
}
```

#### 商品类型分类

| 类型 | 说明 | 示例 | 价格波动 |
|------|------|------|----------|
| 原料 | 初级资源 | 粮食、木材、铁矿 | ±15% |
| 中间品 | 加工产品 | 面粉、布匹、钢材 | ±20% |
| 最终品 | 消费品 | 面包、服装、工具 | ±25% |
| 奢侈品 | 高端商品 | 珠宝、艺术品 | ±35% |
| 军用品 | 军事装备 | 武器、盔甲 | ±30% |

---

## 价格形成机制

### 基础定价

```
基础价格 = 生产成本 + 正常利润
```

#### 生产成本

```
生产成本 = 原料成本 + 加工成本 + 运输成本
```

#### 正常利润

| 商品类型 | 利润率 |
|----------|--------|
| 原料 | 10-20% |
| 中间品 | 15-25% |
| 最终品 | 20-30% |
| 奢侈品 | 30-50% |
| 军用品 | 25-40% |

### 实际定价

```
实际价格 = 基础价格 × 供需系数 × 时代系数 × 市场系数
```

#### 供需系数

```
供需系数 = (1 + 需求/供给)^弹性
```

当供给=需求时，供需系数=1。

#### 时代系数

不同时代价格水平不同：

| 时代 | 时代系数 | 说明 |
|------|----------|------|
| 石器 | 0.8 | 价格较低 |
| 青铜 | 0.9 | 价格适中 |
| 铁器 | 1.0 | 标准价格 |
| 工业 | 1.2 | 价格上涨 |
| 电气 | 1.4 | 价格较高 |
| 信息 | 1.6 | 价格很高 |
| AI | 2.0 | 价格极高 |

#### 市场系数

```
市场系数 = 基础系数 × (1 + 市场繁荣度)
```

| 市场繁荣度 | 市场系数 |
|------------|----------|
| 萧条 | 0.8 |
| 正常 | 1.0 |
| 繁荣 | 1.2 |
| 过热 | 1.4 |

---

## 供需系统

### 需求（Demand）

需求是对商品的需求总量。

#### 需求来源

| 需求类型 | 说明 | 比例 |
|----------|------|------|
| 生活需求 | 人口日常消费 | 40% |
| 生产需求 | 生产活动消耗 | 35% |
| 军事需求 | 军事活动消耗 | 15% |
| 投资需求 | 囤积和储备 | 10% |

#### 需求计算

```
总需求 = 生活需求 + 生产需求 + 军事需求 + 投资需求
```

#### 需求影响因素

- 人口数量
- 生活水平
- 生产活动规模
- 军事活动规模
- 市场预期

### 供给（Supply）

供给是商品的供应总量。

#### 供给来源

| 供给类型 | 说明 | 比例 |
|----------|------|------|
| 国内生产 | 本国生产产出 | 70% |
| 进口贸易 | 从外国进口 | 20% |
| 战略储备 | 释放储备 | 5% |
| 其他来源 | 捐赠、掠夺等 | 5% |

#### 供给计算

```
总供给 = 国内生产 + 进口贸易 + 战略储备 + 其他来源
```

#### 供给影响因素

- 产能规模
- 生产效率
- 运输能力
- 库存水平
- 生产成本

---

## 价格波动

### 波动原因

#### 自然波动

- 季节变化
- 气候影响
- 资源枯竭

#### 市场波动

- 供需变化
- 竞争变化
- 技术进步

#### 外部冲击

- 战争冲突
- 自然灾害
- 政策变化

### 波动幅度

| 商品类型 | 日波动 | 月波动 | 年波动 |
|----------|--------|--------|--------|
| 原料 | ±1% | ±5% | ±15% |
| 中间品 | ±1.5% | ±8% | ±20% |
| 最终品 | ±2% | ±10% | ±25% |
| 奢侈品 | ±3% | ±15% | ±35% |
| 军用品 | ±2.5% | ±12% | ±30% |

### 波动机制

```
价格变化 = 当前价格 × 波动幅度 × 随机系数
```

随机系数：-1 到 1 的随机值。

---

## 价格弹性

### 需求弹性

需求弹性衡量需求对价格变化的敏感度。

```
需求弹性 = 需求变化率 / 价格变化率
```

#### 弹性分类

| 弹性值 | 分类 | 说明 |
|--------|------|------|
| <0.5 | 缺乏弹性 | 需求对价格不敏感 |
| 0.5-1.0 | 弹性一般 | 需求对价格敏感度一般 |
| >1.0 | 富有弹性 | 需求对价格很敏感 |

#### 示例商品弹性

| 商品 | 需求弹性 | 说明 |
|------|----------|------|
| 粮食 | 0.3 | 必需品，缺乏弹性 |
| 药品 | 0.4 | 必需品，缺乏弹性 |
| 奢侈品 | 1.2 | 非必需品，富有弹性 |
| 娱乐品 | 1.5 | 非必需品，富有弹性 |

### 供给弹性

供给弹性衡量供给对价格变化的敏感度。

```
供给弹性 = 供给变化率 / 价格变化率
```

#### 弹性分类

| 弹性值 | 分类 | 说明 |
|--------|------|------|
| <0.5 | 缺乏弹性 | 供给对价格不敏感 |
| 0.5-1.0 | 弹性一般 | 供给对价格敏感度一般 |
| >1.0 | 富有弹性 | 供给对价格很敏感 |

#### 示例商品弹性

| 商品 | 供给弹性 | 说明 |
|------|----------|------|
| 农产品 | 0.4 | 受季节限制，缺乏弹性 |
| 工业品 | 0.8 | 可调整产能，弹性一般 |
| 手工艺品 | 1.2 | 可快速调整，富有弹性 |

---

## 市场事件

### 事件类型

#### 经济事件

| 事件 | 效果 | 持续时间 |
|------|------|----------|
| 经济繁荣 | 价格上涨10% | 30天 |
| 经济萧条 | 价格下跌15% | 45天 |
| 通货膨胀 | 所有价格上涨20% | 60天 |
| 通货紧缩 | 所有人格下跌15% | 60天 |

#### 供需事件

| 事件 | 效果 | 持续时间 |
|------|------|----------|
| 丰收 | 粮食价格下跌30% | 30天 |
| 歉收 | 粮食价格上涨50% | 30天 |
| 资源枯竭 | 对应商品价格上涨40% | 90天 |
| 新资源发现 | 对应商品价格下跌25% | 45天 |

#### 贸易事件

| 事件 | 效果 | 持续时间 |
|------|------|----------|
| 贸易战 | 关税提高50% | 90天 |
| 贸易协定 | 关税降低30% | 180天 |
| 贸易禁运 | 停止特定商品贸易 | 60天 |
| 贸易繁荣 | 贸易量增加50% | 45天 |

### 事件触发机制

#### 随机触发

```
每日触发概率 = 基础概率 × 事件权重
```

#### 条件触发

当满足特定条件时触发：
- 价格达到阈值
- 供需比例异常
- 特定日期/时期

---

## 贸易系统

### 内部贸易

国内不同区域间的商品交换。

#### 贸易成本

```
贸易成本 = 运输成本 + 交易成本 + 税收成本
```

#### 运输成本

```
运输成本 = 单位成本 × 距离 × 运输量
```

#### 交易成本

```
交易成本 = 贸易金额 × 交易税率
```

### 外部贸易

与其他文明的商品交换。

#### 贸易协定

| 协定类型 | 关税优惠 | 其他优惠 |
|----------|----------|----------|
| 无协定 | 0% | 无 |
| 普通协定 | 10% | 简化流程 |
| 自由贸易 | 30% | 快速通道 |
| 经济联盟 | 50% | 无需关税 |

#### 贸易平衡

```
贸易顺差 = 出口额 - 进口额
```

贸易顺差过大可能导致：
- 货币升值
- 出口竞争力下降
- 贸易摩擦

---

## 价格干预

### 干预手段

#### 价格上限

```
价格上限 = 基础价格 × 上限系数
```

上限系数：0.8-1.2

#### 价格下限

```
价格下限 = 基础价格 × 下限系数
```

下限系数：0.8-1.2

#### 补贴政策

```
补贴后价格 = 市场价格 - 补贴金额
```

#### 税收政策

```
税收后价格 = 市场价格 + 税收金额
```

### 干预效果

| 干预类型 | 短期效果 | 长期效果 |
|----------|----------|----------|
| 价格上限 | 稳定价格 | 供给不足 |
| 价格下限 | 保护生产 | 需求不足 |
| 补贴政策 | 降低价格 | 财政负担 |
| 税收政策 | 增加收入 | 价格上涨 |

---

## 市场系统与其他系统的关系

### 与生产系统

- 生产增加供给
- 供给影响价格
- 价格引导生产

### 与人口系统

- 人口影响需求
- 需求影响价格
- 价格影响生活水平

### 与科技系统

- 科技影响生产成本
- 成本影响价格
- 价格影响技术选择

### 与运输系统

- 运输影响贸易成本
- 成本影响价格
- 价格影响贸易量
