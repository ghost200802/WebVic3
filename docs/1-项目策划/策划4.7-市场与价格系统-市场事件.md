# 市场与价格系统 - 市场事件

## 概述

市场事件是影响市场的重要随机因素，包括经济、供需、贸易等各类事件。事件会显著影响价格、供需和市场状态。

---

## 事件分类

### 经济事件

#### 繁荣事件

```
事件效果：价格上涨10%，需求增加15%
持续时间：30天
触发条件：市场稳定期
影响范围：所有商品
```

| 事件等级 | 价格上涨 | 需求增加 | 持续时间 |
|----------|----------|----------|----------|
| 轻度繁荣 | +5% | +8% | 20天 |
| 中度繁荣 | +10% | +15% | 30天 |
| 高度繁荣 | +15% | +25% | 45天 |

#### 萧条事件

```
事件效果：价格下跌15%，需求减少20%
持续时间：45天
触发条件：繁荣后或随机
影响范围：所有商品
```

| 事件等级 | 价格下跌 | 需求减少 | 持续时间 |
|----------|----------|----------|----------|
| 轻度萧条 | -8% | -10% | 30天 |
| 中度萧条 | -15% | -20% | 45天 |
| 重度萧条 | -25% | -35% | 60天 |

#### 通胀事件

```
事件效果：所有价格上涨20%
持续时间：60天
触发条件：货币超发或随机
影响范围：所有商品
```

| 通胀率 | 价格上涨 | 持续时间 | 影响 |
|--------|----------|----------|------|
| 温和通胀 | +10% | 60天 | 可接受 |
| 中度通胀 | +20% | 60天 | 有压力 |
| 高通胀 | +35% | 90天 | 有问题 |
| 恶性通胀 | +50% | 120天 | 严重问题 |

#### 通缩事件

```
事件效果：所有价格下跌15%
持续时间：60天
触发条件：需求不足或随机
影响范围：所有商品
```

| 通缩率 | 价格下跌 | 持续时间 | 影响 |
|--------|----------|----------|------|
| 温和通缩 | -8% | 60天 | 可接受 |
| 中度通缩 | -15% | 60天 | 有压力 |
| 严重通缩 | -25% | 90天 | 有问题 |

---

## 供需事件

### 丰收事件

```
事件效果：粮食价格下跌30%
持续时间：30天
触发条件：良好气候或科技突破
影响范围：粮食类商品
```

| 丰收程度 | 价格下跌 | 产量增加 | 持续时间 |
|----------|----------|----------|----------|
| 小丰收 | -20% | +25% | 20天 |
| 大丰收 | -30% | +40% | 30天 |
| 特大丰收 | -45% | +60% | 45天 |

### 歉收事件

```
事件效果：粮食价格上涨50%
持续时间：30天
触发条件：恶劣气候或灾害
影响范围：粮食类商品
```

| 歉收程度 | 价格上涨 | 产量减少 | 持续时间 |
|----------|----------|----------|----------|
| 小歉收 | +30% | -25% | 20天 |
| 大歉收 | +50% | -40% | 30天 |
| 特大歉收 | +80% | -60% | 45天 |

### 资源枯竭事件

```
事件效果：对应商品价格上涨40%
持续时间：90天
触发条件：资源储量<10%
影响范围：特定资源商品
```

| 枯竭程度 | 价格上涨 | 产量减少 | 持续时间 |
|----------|----------|----------|----------|
| 轻度枯竭 | +25% | -15% | 60天 |
| 中度枯竭 | +40% | -30% | 90天 |
| 严重枯竭 | +60% | -50% | 180天 |

### 新资源发现事件

```
事件效果：对应商品价格下跌25%
持续时间：45天
触发条件：新矿床发现或勘探成功
影响范围：特定资源商品
```

| 发现规模 | 价格下跌 | 产量增加 | 持续时间 |
|----------|----------|----------|----------|
| 小型发现 | -15% | +20% | 30天 |
| 中型发现 | -25% | +40% | 45天 |
| 大型发现 | -40% | +60% | 60天 |

---

## 贸易事件

### 贸易战事件

```
事件效果：关税提高50%
持续时间：90天
触发条件：外交关系恶化
影响范围：贸易商品
```

| 贸易战强度 | 关税提高 | 贸易量减少 | 持续时间 |
|------------|----------|------------|----------|
| 轻度 | +30% | -20% | 60天 |
| 中度 | +50% | -35% | 90天 |
| 严重 | +70% | -50% | 120天 |

### 贸易协定事件

```
事件效果：关税降低30%
持续时间：180天
触发条件：外交关系改善
影响范围：贸易商品
```

| 协定类型 | 关税降低 | 贸易量增加 | 持续时间 |
|----------|----------|------------|----------|
| 普通协定 | -15% | +20% | 120天 |
| 自由贸易 | -30% | +40% | 180天 |
| 经济联盟 | -50% | +60% | 365天 |

### 贸易禁运事件

```
事件效果：停止特定商品贸易
持续时间：60天
触发条件：外交关系破裂或战争
影响范围：特定商品
```

| 禁运程度 | 贸易量减少 | 价格上涨 | 持续时间 |
|----------|------------|----------|----------|
| 部分禁运 | -50% | +30% | 60天 |
| 全面禁运 | -100% | +60% | 90天 |
| 长期禁运 | -100% | +80% | 180天 |

### 贸易繁荣事件

```
事件效果：贸易量增加50%
持续时间：45天
触发条件：市场繁荣或政策支持
影响范围：所有贸易商品
```

| 繁荣程度 | 贸易量增加 | 价格变化 | 持续时间 |
|----------|------------|----------|----------|
| 轻度繁荣 | +30% | -5% | 30天 |
| 中度繁荣 | +50% | -10% | 45天 |
| 高度繁荣 | +80% | -15% | 60天 |

---

## 科技事件

### 技术突破事件

```
事件效果：生产成本下降20%
持续时间：永久
触发条件：科技研发成功
影响范围：特定技术相关商品
```

| 突破等级 | 成本下降 | 产能提升 | 持续时间 |
|----------|----------|----------|----------|
| 小突破 | -15% | +10% | 永久 |
| 中突破 | -20% | +20% | 永久 |
| 大突破 | -35% | +40% | 永久 |

### 技术扩散事件

```
事件效果：其他文明获得相同技术
持续时间：永久
触发条件：技术突破后
影响范围：其他文明
```

| 扩散速度 | 传播时间 | 影响范围 |
|----------|----------|----------|
| 快速 | 30天 | 所有友好文明 |
| 中等 | 60天 | 邻近文明 |
| 缓慢 | 90天 | 少数文明 |

---

## 战争事件

### 战争爆发事件

```
事件效果：军用品价格+60%，粮食价格+30%
持续时间：180天
触发条件：外交冲突
影响范围：军用品、粮食
```

| 战争规模 | 军用品上涨 | 粮食上涨 | 持续时间 |
|----------|------------|----------|----------|
| 小规模战争 | +30% | +15% | 60天 |
| 区域战争 | +60% | +30% | 180天 |
| 全面战争 | +100% | +50% | 365天 |

### 战争结束事件

```
事件效果：军用品价格下跌40%，粮食价格正常化
持续时间：90天
触发条件：战争结束
影响范围：军用品、粮食
```

| 战后状态 | 军用品下跌 | 恢复时间 |
|----------|------------|----------|
| 小规模战后 | -25% | 60天 |
| 区域战后 | -40% | 90天 |
| 全面战后 | -50% | 180天 |

---

## 自然灾害事件

### 地震事件

```
事件效果：建材价格+15%，工具价格+10%
持续时间：15-30天
触发条件：随机
影响范围：建材、工具
```

| 地震等级 | 建材上涨 | 工具上涨 | 持续时间 |
|----------|----------|----------|----------|
| 轻微 | +8% | +5% | 15天 |
| 中等 | +15% | +10% | 20天 |
| 严重 | +30% | +20% | 30天 |

### 洪水事件

```
事件效果：食品价格+25%，建材价格+20%
持续时间：30-60天
触发条件：随机
影响范围：食品、建材
```

| 洪水等级 | 食品上涨 | 建材上涨 | 持续时间 |
|----------|----------|----------|----------|
| 轻微 | +15% | +10% | 30天 |
| 中等 | +25% | +20% | 45天 |
| 严重 | +40% | +35% | 60天 |

### 瘟疫事件

```
事件效果：药品价格+35%，粮食价格+20%
持续时间：60-90天
触发条件：随机
影响范围：药品、粮食
```

| 瘟疫等级 | 药品上涨 | 粮食上涨 | 持续时间 |
|----------|----------|----------|----------|
| 轻微 | +20% | +10% | 60天 |
| 中等 | +35% | +20% | 75天 |
| 严重 | +50% | +30% | 90天 |

---

## 事件触发机制

### 随机触发

```
每日触发概率 = 基础概率 × 事件权重 × 市场状态
```

#### 基础概率

| 事件类型 | 基础概率 | 说明 |
|----------|----------|------|
| 经济事件 | 0.1% | 较低 |
| 供需事件 | 0.2% | 中等 |
| 贸易事件 | 0.15% | 中等 |
| 战争事件 | 0.05% | 很低 |
| 灾害事件 | 0.08% | 低 |

#### 事件权重

| 事件重要性 | 权重 | 说明 |
|------------|------|------|
| 普通事件 | 1.0 | 基准 |
| 重要事件 | 2.0 | 更高概率 |
| 重大事件 | 3.0 | 更高概率 |

### 条件触发

当满足特定条件时触发：

| 条件类型 | 触发条件 | 触发事件 |
|----------|----------|----------|
| 价格阈值 | 价格>上限/下限 | 价格干预事件 |
| 供需比例 | 供需>1.5或<0.7 | 供需平衡事件 |
| 储量阈值 | 储量<10% | 资源枯竭事件 |
| 关系阈值 | 关系恶化 | 贸易战事件 |

---

## 事件叠加

### 叠加规则

```
总效果 = Σ(事件效果 × 叠加系数)
```

### 叠加系数

| 事件数量 | 叠加系数 | 说明 |
|----------|----------|------|
| 1个 | 1.0 | 完全效果 |
| 2个 | 0.9 | 略微减弱 |
| 3个 | 0.8 | 明显减弱 |
| 4个+ | 0.7 | 显著减弱 |

### 事件冲突

当事件效果冲突时：

```
最终效果 = (正向效果 - 负向效果) × 冲突系数
```

| 冲突类型 | 冲突系数 | 说明 |
|----------|----------|------|
| 轻微冲突 | 0.8 | 相互抵消 |
| 中等冲突 | 0.6 | 部分抵消 |
| 严重冲突 | 0.4 | 大部分抵消 |

---

## 事件影响

### 价格影响

```
价格影响 = Σ(事件价格影响 × 影响权重)
```

| 影响类型 | 影响权重 | 说明 |
|----------|----------|------|
| 直接影响 | 1.0 | 完全影响 |
| 间接影响 | 0.5 | 部分影响 |
| 次要影响 | 0.2 | 轻微影响 |

### 供需影响

```
需求影响 = Σ(事件需求影响 × 影响权重)
供给影响 = Σ(事件供给影响 × 影响权重)
```

### 经济影响

```
经济增长影响 = 事件影响 × 持续时间 × 影响范围
```

---

## 事件应对

### 应对策略

#### 价格应对

| 事件类型 | 应对措施 | 效果 |
|----------|----------|------|
| 价格上涨 | 释放储备 | 稳定价格 |
| 价格下跌 | 收购储备 | 支撑价格 |
| 价格波动 | 限制投机 | 减少波动 |

#### 供需应对

| 事件类型 | 应对措施 | 效果 |
|----------|----------|------|
| 供给短缺 | 增加进口 | 补充供给 |
| 需求过热 | 限制消费 | 减少需求 |
| 供需失衡 | 调整生产 | 恢复平衡 |

#### 贸易应对

| 事件类型 | 应对措施 | 效果 |
|----------|----------|------|
| 贸易战 | 寻找新伙伴 | 分散风险 |
| 禁运 | 国内替代 | 减少依赖 |
| 协定 | 充分利用 | 增加贸易 |

---

## 事件数据示例

### 事件频率统计

| 事件类型 | 年平均次数 | 最大次数 | 最小次数 |
|----------|------------|----------|----------|
| 经济事件 | 2-3 | 5 | 0 |
| 供需事件 | 3-5 | 8 | 1 |
| 贸易事件 | 2-4 | 6 | 0 |
| 战争事件 | 0-1 | 2 | 0 |
| 灾害事件 | 1-2 | 4 | 0 |

### 事件影响统计

| 事件类型 | 平均价格影响 | 最大价格影响 | 平均持续时间 |
|----------|--------------|--------------|--------------|
| 繁荣事件 | +10% | +20% | 30天 |
| 萧条事件 | -15% | -30% | 45天 |
| 丰收事件 | -30% | -50% | 30天 |
| 歉收事件 | +50% | +80% | 30天 |
| 贸易战 | +50% | +70% | 90天 |
| 战争 | +60% | +100% | 180天 |

---

## 事件系统接口定义

### 事件管理器接口

```typescript
interface IEventManager {
  checkEventTrigger(): void
  applyEvent(event: MarketEvent): void

  getActiveEvents(): MarketEvent[]
  getEventHistory(): EventRecord[]

  cancelEvent(eventId: string): void

  setEventWeight(eventType: string, weight: number): void
}

interface MarketEvent {
  id: string
  type: EventType
  name: string
  description: string

  effects: EventEffect[]
  duration: number
  triggerCondition: TriggerCondition

  startDate: number
  endDate?: number
  isActive: boolean
}

interface EventEffect {
  type: 'price' | 'demand' | 'supply'
  target: string
  value: number
}
```

---

## 事件系统性能优化

### 计算优化

1. **事件队列**：使用优先级队列管理事件
2. **批量处理**：批量处理多个事件
3. **事件缓存**：缓存事件效果
4. **事件预计算**：预计算事件影响

### 存储优化

1. **增量存储**：只存储活跃事件
2. **定期清理**：清理过期事件
3. **压缩存储**：压缩事件历史
