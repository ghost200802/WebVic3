# 生产系统 - 核心概念

## 系统概述

生产系统是游戏的核心经济引擎，负责模拟从石器时代到AI时代的商品生产过程。系统处理生产链、生产方式选择、效率计算、资源消耗等核心经济活动。

---

## 核心概念

### 商品（Goods）

商品是生产系统的基本单位，按用途和属性分为以下类型：

#### 商品类型分类

| 类型 | 说明 | 示例商品 |
|------|------|----------|
| 原料 | 自然获取或初级加工 | 粮食、木材、石材、矿石 |
| 中间品 | 需要进一步加工 | 面粉、布匹、钢材 |
| 最终品 | 直接消费或使用 | 面包、服装、工具 |
| 奢侈品 | 提升生活水平 | 珠宝、香料、艺术品 |
| 军用品 | 军事消耗 | 武器、盔甲 |

#### 商品属性

每个商品包含以下属性：

```typescript
interface Goods {
  id: string
  name: string
  type: GoodsType
  era: Era
  basePrice: number
  priceHistory: PriceRecord[]
}
```

### 建筑（Building）

建筑是进行生产的场所，是生产活动的载体。

#### 建筑基本属性

```typescript
interface Building {
  id: string
  name: string
  type: BuildingType
  
  minEra: Era
  maxEra?: Era
  
  constructionCost: Record<string, number>
  constructionTime: number
  
  baseWorkers: number
  maxWorkers: number
  currentWorkers: number
  
  baseThroughput: number
  
  productionMethods: string[]
  level: number
  experience: number
  tileId: string
}
```

#### 建筑关键属性说明

| 属性 | 说明 |
|------|------|
| `minEra` | 建筑可建造的最早时代 |
| `maxEra` | 建筑可使用的最晚时代（可选） |
| `baseWorkers` | 基础工位数（参考值，用于产能计算） |
| `maxWorkers` | 最大可分配工人数 |
| `currentWorkers` | 当前实际工人数（初始为0，需手动分配） |
| `baseThroughput` | 基础产能 |
| `productionMethods` | 该建筑可用的生产方式列表 |
| `level` | 建筑等级（通过升级提升） |
| `experience` | 建筑经验值（影响升级） |

#### 工人分配机制

- 新建建筑的工人数量初始为 **0**
- 玩家需要手动通过界面分配工人到建筑
- 工人数量范围：0 到 maxWorkers
- 工人数量直接影响产能：实际产能 = 基础产能 × (当前工人数 / 基础工位数)

### 生产方式（Production Method）

同一建筑可选择不同的生产方式，代表不同的技术水平和生产模式。

#### 生产方式属性

```typescript
interface ProductionMethod {
  id: string
  name: string
  buildingType: string
  
  requiredTech?: string[]
  requiredEra?: Era
  
  inputs: Record<string, number>
  outputs: Record<string, number>
  
  throughputModifier: number
  workerEfficiency: number
  pollution?: number
  automationLevel: number
}
```

#### 生产方式关键属性说明

| 属性 | 说明 |
|------|------|
| `requiredTech` | 解锁该生产方式所需的科技 |
| `requiredEra` | 解锁该生产方式所需的最低时代 |
| `inputs` | 每单位生产所需的投入品 |
| `outputs` | 每单位生产产出的商品 |
| `throughputModifier` | 产能修正系数 |
| `workerEfficiency` | 工人效率修正 |
| `pollution` | 污染产出（工业时代后） |
| `automationLevel` | 自动化程度（0-1，1为完全自动化） |

---

## 建筑与生产方式的关系

### 多对多关系

- **一个建筑类型** 可以有 **多个生产方式**
- **一个生产方式** 只能用于 **一种建筑类型**

示例：农田建筑可以有以下生产方式：
- 刀耕火种（石器时代）
- 畜力耕作（青铜时代）
- 铁犁牛耕（铁器时代）
- 机械化（工业时代）
- 现代农业（信息时代）

### 生产方式切换

玩家可以随时在建筑中切换生产方式（前提是已解锁）：

1. 切换无需成本
2. 切换立即生效
3. 切换后使用新的投入产出规则
4. 不同生产方式对工人效率有不同影响

---

## 生产系统的核心循环

### 生产周期

- 游戏内 **1天** 为一个生产周期
- 每个周期结束时：
  - 消耗投入品
  - 产出商品
  - 计算利润/亏损

### 投入不足处理

当投入品不足时：

```
实际产出 = 理论产出 × min(各投入品充足率)
```

- 投入品充足率 = 当前库存 / 需要量
- 按最紧缺的投入品计算实际产出
- 投入品不足会降低生产效率

---

## 生产系统的时代特征

### 石器时代

- 原始采集和简单制作
- 无复杂生产链
- 工具简陋，效率低下
- 依赖自然资源

### 青铜/铁器时代

- 金属工具出现
- 农业和手工业发展
- 简单的生产链形成
- 城市兴起

### 古典/中世纪

- 分工明确
- 生产专业化
- 生产链复杂化
- 贸易发展

### 工业时代

- 机械化生产
- 大规模工厂
- 生产效率飞跃
- 新能源利用

### 电气/信息时代

- 电力驱动
- 自动化生产
- 精密制造
- 高附加值产品

### AI时代

- 智能制造
- 全自动化
- 高度定制化
- 可持续生产

---

## 生产系统与其他系统的关系

### 与市场系统的关系

- 建筑产出商品 → 增加市场供给
- 建筑消耗投入品 → 增加市场需求
- 价格影响生产决策

### 与人口系统的关系

- 建筑需要劳动力
- 工人效率受教育水平和生活水平影响
- 人口增长提供更多劳动力

### 与科技系统的关系

- 科技解锁新的建筑类型
- 科技解锁新的生产方式
- 科技提升生产效率

### 与地形系统的关系

- 建筑必须建设在地块上
- 地形影响建筑产出效率
- 资源矿床限制特定建筑

### 与运输系统的关系

- 运力不足影响生产效率
- 产出商品需要运力支持
- 投入品运输需要运力支持
