# 生产系统 - 产能升级

## 概述

产能升级是提升建筑产出效率的核心机制。通过升级建筑等级，玩家可以显著提升生产效率，解锁新的生产可能性。

---

## 升级机制概述

### 升级方式

建筑升级有三种方式：

| 方式 | 描述 | 速度 | 成本 |
|------|------|------|------|
| 经验升级 | 通过日常生产积累经验自动升级 | 慢 | 低 |
| 投资升级 | 投入资源直接升级 | 快 | 高 |
| 科技升级 | 科技解锁后自动提升 | 瞬间 | 科技成本 |

---

## 经验升级系统

### 经验获取

建筑通过日常生产获得经验：

```typescript
interface Building {
  experience: number
  level: number
  maxLevel: number
}

function calculateDailyExperience(building: Building): number {
  const baseExperience = 10
  const efficiency = building.productionEfficiency
  const levelBonus = Math.sqrt(building.level)

  return Math.floor(baseExperience * efficiency * levelBonus)
}
```

### 经验公式

#### 基础经验

```
每日经验 = 基础经验 × 产出效率 × 等级加成
```

#### 效率系数

| 产出效率 | 经验系数 |
|----------|----------|
| <50% | 0.5 |
| 50-80% | 0.8 |
| 80-100% | 1.0 |
| 100-150% | 1.5 |
| >150% | 2.0 |

#### 等级加成

```
等级加成 = sqrt(等级)
```

### 升级所需经验

```
升级所需经验 = 基础经验 × 等级^1.5 × 难度系数
```

#### 经验需求表

| 等级 | 升级所需经验 | 累计经验 | 预计天数 |
|------|--------------|----------|----------|
| 1→2 | 100 | 100 | 10 |
| 2→3 | 283 | 383 | 28 |
| 3→4 | 580 | 963 | 58 |
| 4→5 | 1000 | 1963 | 100 |
| 5→6 | 1565 | 3528 | 157 |
| 6→7 | 2290 | 5818 | 229 |
| 7→8 | 3196 | 9014 | 320 |
| 8→9 | 4290 | 13304 | 429 |
| 9→10 | 5590 | 18894 | 559 |

### 经验升级优势

- 成本低
- 自动进行
- 不需要额外投入
- 反映建筑使用频率

### 经验升级劣势

- 速度慢
- 需要持续生产
- 高等级升级时间长

---

## 投资升级系统

### 升级成本

```
升级成本 = 基础成本 × 等级^1.2
```

#### 升级成本表

| 等级 | 升级成本 | 成本倍率 | 资源类型 |
|------|----------|----------|----------|
| 1→2 | 1.5x | 1.5 | 钢材、资金 |
| 2→3 | 2.0x | 1.33 | 钢材、资金、电子元件 |
| 3→4 | 2.5x | 1.25 | 钢材、资金、电子元件 |
| 4→5 | 3.0x | 1.20 | 钢材、资金、电子元件、稀土 |
| 5→6 | 3.5x | 1.17 | 钢材、资金、电子元件、稀土 |
| 6→7 | 4.0x | 1.14 | 钢材、资金、电子元件、稀土 |
| 7→8 | 4.5x | 1.13 | 钢材、资金、电子元件、稀土 |
| 8→9 | 5.0x | 1.11 | 钢材、资金、电子元件、稀土 |
| 9→10 | 5.5x | 1.10 | 钢材、资金、电子元件、稀土 |

### 升级时间

```
升级时间 = 基础时间 × 等级^0.8
```

#### 升级时间表

| 等级 | 升级时间 | 时间倍率 | 说明 |
|------|----------|----------|------|
| 1→2 | 5天 | 1.0 | 基础时间 |
| 2→3 | 7天 | 1.4 | - |
| 3→4 | 9天 | 1.8 | - |
| 4→5 | 11天 | 2.2 | - |
| 5→6 | 13天 | 2.6 | - |
| 6→7 | 15天 | 3.0 | - |
| 7→8 | 17天 | 3.4 | - |
| 8→9 | 19天 | 3.8 | - |
| 9→10 | 21天 | 4.2 | 最长时间 |

### 升级期间

升级期间建筑：
- 继续生产（50%产能）
- 无法获得经验
- 无法再次升级

---

## 科技升级系统

### 科技效果

某些科技提供全局或特定建筑升级效果：

| 科技 | 效果 | 影响建筑 | 时代 |
|------|------|----------|------|
| 农业科技 | 农田+10%产能 | 农田 | 中世纪 |
| 采矿科技 | 矿场+15%产能 | 矿场 | 中世纪 |
| 冶炼技术 | 冶炼厂+20%产能 | 冶炼厂 | 工业 |
| 机械化 | 工厂+30%产能 | 工厂 | 电气 |
| 自动化 | 工厂+50%产能 | 工厂 | 信息 |
| AI技术 | 全部+20%产能 | 全部 | AI |

### 科技升级特点

- 瞬间生效
- 无需额外投入
- 影响范围广
- 可叠加

---

## 升级效果

### 产能提升

```
产能 = 基础产能 × (1 + (等级 - 1) × 0.2)
```

#### 产能提升表

| 等级 | 产能倍率 | 说明 |
|------|----------|------|
| 1 | 100% | 基础产能 |
| 2 | 120% | +20% |
| 3 | 140% | +20% |
| 4 | 165% | +25% |
| 5 | 195% | +30% |
| 6 | 230% | +35% |
| 7 | 270% | +40% |
| 8 | 315% | +45% |
| 9 | 365% | +50% |
| 10 | 420% | +55% |

### 工位数提升

```
最大工人数 = 基础工位数 × (1 + (等级 - 1) × 0.1)
```

#### 工位数提升表

| 等级 | 工位数倍率 | 说明 |
|------|------------|------|
| 1 | 100% | 基础工位数 |
| 2 | 110% | +10% |
| 3 | 120% | +10% |
| 4 | 130% | +10% |
| 5 | 145% | +15% |
| 6 | 160% | +15% |
| 7 | 175% | +15% |
| 8 | 190% | +15% |
| 9 | 205% | +15% |
| 10 | 220% | +20% |

### 效率提升

```
生产效率 = 基础效率 × (1 + 等级 × 0.05)
```

#### 效率提升表

| 等级 | 效率倍率 | 说明 |
|------|----------|------|
| 1 | 100% | 基础效率 |
| 2 | 105% | +5% |
| 3 | 110% | +5% |
| 4 | 115% | +5% |
| 5 | 120% | +5% |
| 6 | 125% | +5% |
| 7 | 130% | +5% |
| 8 | 135% | +5% |
| 9 | 140% | +5% |
| 10 | 145% | +5% |

---

## 升级策略

### 早期策略（1-3级）

#### 优先级

1. 资源采集建筑
2. 基础生产建筑
3. 基础设施建筑

#### 策略

- 使用经验升级
- 优先升级常用建筑
- 保持建筑平衡发展

### 中期策略（4-6级）

#### 优先级

1. 关键瓶颈建筑
2. 高利润建筑
3. 核心生产链建筑

#### 策略

- 结合投资升级
- 专注核心建筑
- 快速突破瓶颈

### 后期策略（7-10级）

#### 优先级

1. 高级建筑
2. 稀缺资源建筑
3. 关键基础设施

#### 策略

- 大规模投资升级
- 配合科技升级
- 追求极致效率

---

## 升级成本效益分析

### 投资回报期

```
投资回报期 = 升级成本 / (升级后利润 - 升级前利润)
```

#### 回报期示例

| 建筑等级 | 升级成本 | 产能提升 | 利润提升 | 回报期 |
|----------|----------|----------|----------|--------|
| 1→2 | 1500 | +20% | +200 | 7.5天 |
| 2→3 | 2000 | +20% | +240 | 8.3天 |
| 3→4 | 2500 | +25% | +320 | 7.8天 |
| 4→5 | 3000 | +30% | +420 | 7.1天 |
| 5→6 | 3500 | +35% | +560 | 6.3天 |
| 6→7 | 4000 | +40% | +720 | 5.6天 |
| 7→8 | 4500 | +45% | +900 | 5.0天 |
| 8→9 | 5000 | +50% | +1120 | 4.5天 |
| 9→10 | 5500 | +55% | +1380 | 4.0天 |

### 升级优先级

| 优先级 | 建筑类型 | 理由 |
|--------|----------|------|
| 最高 | 资源采集建筑 | 原料基础 |
| 高 | 瓶颈建筑 | 限制整体产出 |
| 中 | 高利润建筑 | 快速回收成本 |
| 低 | 辅助建筑 | 非核心功能 |

---

## 升级限制

### 最大等级限制

```
最大等级 = 10
```

特殊情况：
- 特殊建筑可能有不同上限
- 科技可能提高上限
- 某些建筑不可升级

### 升级前置条件

某些升级需要满足条件：

| 升级等级 | 前置条件 |
|----------|----------|
| 1→2 | 无 |
| 2→3 | 建筑经验≥100 |
| 3→4 | 建筑经验≥500，对应科技 |
| 4→5 | 建筑经验≥1000，对应科技 |
| 5→6 | 建筑经验≥2000，对应科技 |
| 6→7 | 建筑经验≥3500，对应科技 |
| 7→8 | 建筑经验≥5500，对应科技 |
| 8→9 | 建筑经验≥8000，对应科技 |
| 9→10 | 建筑经验≥11000，对应科技 |

---

## 升级与生产方式

### 升级影响

建筑升级不影响生产方式选择，但可以：
- 提升现有生产方式效率
- 解锁新的生产方式
- 降低生产方式切换成本

### 组合效果

```
总效率 = 基础效率 × 生产方式修正 × 升级修正
```

示例：
- 基础效率：100
- 生产方式修正：1.5（机械化）
- 升级修正：1.4（7级）
- 总效率：100 × 1.5 × 1.4 = 210

---

## 升级数据汇总

### 升级总览

| 等级 | 产能倍率 | 工位数倍率 | 效率倍率 | 升级成本 | 升级时间 |
|------|----------|------------|----------|----------|----------|
| 1 | 100% | 100% | 100% | - | - |
| 2 | 120% | 110% | 105% | 1.5x | 5天 |
| 3 | 140% | 120% | 110% | 2.0x | 7天 |
| 4 | 165% | 130% | 115% | 2.5x | 9天 |
| 5 | 195% | 145% | 120% | 3.0x | 11天 |
| 6 | 230% | 160% | 125% | 3.5x | 13天 |
| 7 | 270% | 175% | 130% | 4.0x | 15天 |
| 8 | 315% | 190% | 135% | 4.5x | 17天 |
| 9 | 365% | 205% | 140% | 5.0x | 19天 |
| 10 | 420% | 220% | 145% | 5.5x | 21天 |

---

## 升级系统接口定义

### 升级管理器接口

```typescript
interface IUpgradeManager {
  calculateUpgradeCost(building: Building): UpgradeCost
  calculateUpgradeTime(building: Building): number

  startUpgrade(building: Building): boolean
  checkUpgradeComplete(building: Building): boolean
  cancelUpgrade(building: Building): void

  addExperience(building: Building, amount: number): void
  checkLevelUp(building: Building): boolean
}

interface UpgradeCost {
  resources: Record<string, number>
  money: number
  time: number
}
```

---

## 升级系统性能优化

### 计算优化

1. **预计算**：提前计算升级成本和时间
2. **批量更新**：批量处理多个建筑升级
3. **事件驱动**：只在变化时重新计算
4. **缓存结果**：缓存频繁查询结果

### 存储优化

1. **增量存储**：只存储变化部分
2. **定期清理**：清理历史数据
3. **压缩存储**：压缩升级记录
