# 市场与价格系统 - 供需系统

## 概述

供需系统是市场机制的基础，通过供需关系影响价格和资源配置。本文档详细描述需求、供给以及供需平衡的机制。

---

## 需求系统

### 需求来源

#### 生活需求

人口日常生活对商品的需求。

```
生活需求 = 人口数量 × 人均需求 × 生活水平系数
```

##### 人均需求表

| 商品 | 贫困(0-20) | 困难(20-40) | 正常(40-60) | 良好(60-80) | 富裕(80-100) |
|------|-----------|------------|------------|------------|------------|
| 粮食 | 0.5 | 0.8 | 1.0 | 1.5 | 2.0 |
| 服装 | 0.1 | 0.2 | 0.3 | 0.5 | 0.8 |
| 燃料 | 0.3 | 0.5 | 0.8 | 1.2 | 2.0 |

##### 生活水平系数

| 生活水平 | 系数 |
|----------|------|
| 0-20 | 0.6 |
| 20-40 | 0.8 |
| 40-60 | 1.0 |
| 60-80 | 1.3 |
| 80-100 | 1.8 |

#### 生产需求

生产活动对商品的需求。

```
生产需求 = Σ(建筑需求 × 建筑数量 × 运行效率)
```

##### 建筑需求示例

| 建筑类型 | 主要投入品 | 日均需求 | 时代 |
|----------|------------|----------|------|
| 农田 | 工具、化肥 | 5-10 | 全部 |
| 钢铁厂 | 铁矿、煤炭 | 50-100 | 工业+ |
| 工厂 | 钢材、零件 | 30-80 | 工业+ |
| 电子厂 | 稀土、硅 | 20-50 | 信息+ |

#### 军事需求

军事活动对商品的需求。

```
军事需求 = 军队规模 × 单位需求 × 战争强度
```

##### 军事需求示例

| 军事单位 | 粮食需求 | 武器需求 | 装备需求 |
|----------|----------|----------|----------|
| 步兵 | 2单位/天 | 0.1单位/月 | 0.2单位/月 |
| 骑兵 | 3单位/天 | 0.2单位/月 | 0.4单位/月 |
| 战车 | 5单位/天 | 0.5单位/月 | 1.0单位/月 |

##### 战争强度

| 战争状态 | 战争强度 | 需求倍率 |
|----------|----------|----------|
| 和平 | 0.2 | 0.5x |
| 边境冲突 | 0.5 | 1.0x |
| 小规模战争 | 0.8 | 1.5x |
| 大规模战争 | 1.0 | 2.0x |
| 全面战争 | 1.5 | 3.0x |

#### 投资需求

囤积和储备需求。

```
投资需求 = 基础投资 × 市场预期 × 可支配收入
```

##### 市场预期

| 市场预期 | 预期系数 |
|----------|----------|
| 悲观 | 0.5 |
| 中性 | 1.0 |
| 乐观 | 1.5 |
| 狂热 | 2.0 |

---

## 需求弹性

### 弹性定义

需求弹性衡量需求对价格变化的敏感度。

```
需求弹性 = 需求变化率 / 价格变化率
```

### 弹性分类

#### 缺乏弹性（<0.5）

需求对价格变化不敏感。

| 商品 | 需求弹性 | 特点 |
|------|----------|------|
| 粮食 | 0.3 | 必需品 |
| 药品 | 0.4 | 必需品 |
| 燃料 | 0.4 | 必需品 |

#### 弹性一般（0.5-1.0）

需求对价格变化敏感度一般。

| 商品 | 需求弹性 | 特点 |
|------|----------|------|
| 服装 | 0.7 | 半必需品 |
| 住房 | 0.8 | 半必需品 |
| 交通 | 0.9 | 半必需品 |

#### 富有弹性（>1.0）

需求对价格变化很敏感。

| 商品 | 需求弹性 | 特点 |
|------|----------|------|
| 奢侈品 | 1.5 | 非必需品 |
| 娱乐品 | 1.8 | 非必需品 |
| 高档商品 | 2.0 | 非必需品 |

---

## 需求预测

### 短期预测（1-30天）

```
短期需求 = 当前需求 × (1 + 短期趋势 × 时间因子)
```

| 时间因子 | 短期趋势 | 说明 |
|----------|----------|------|
| 1天 | 0.05 | 小幅变化 |
| 7天 | 0.15 | 中等变化 |
| 15天 | 0.30 | 较大变化 |
| 30天 | 0.50 | 显著变化 |

### 中期预测（1-12月）

```
中期需求 = 当前需求 × (1 + 中期趋势 × 时间因子)
```

| 时间因子 | 中期趋势 | 说明 |
|----------|----------|------|
| 1月 | 0.10 | 小幅变化 |
| 3月 | 0.25 | 中等变化 |
| 6月 | 0.50 | 较大变化 |
| 12月 | 1.00 | 显著变化 |

### 长期预测（1-10年）

```
长期需求 = 当前需求 × (1 + 长期趋势 × 时间因子)
```

| 时间因子 | 长期趋势 | 说明 |
|----------|----------|------|
| 1年 | 0.20 | 小幅变化 |
| 3年 | 0.60 | 中等变化 |
| 5年 | 1.00 | 较大变化 |
| 10年 | 2.00 | 显著变化 |

---

## 供给系统

### 供给来源

#### 国内生产

本国生产活动的产出。

```
国内生产 = Σ(建筑产能 × 建筑数量 × 运行效率)
```

##### 建筑产能示例

| 建筑类型 | 产能 | 时代 |
|----------|------|------|
| 农田 | 20-200单位/天 | 全部 |
| 矿场 | 15-60单位/天 | 全部 |
| 工厂 | 40-200单位/天 | 工业+ |
| 电子厂 | 30-150单位/天 | 信息+ |

#### 进口贸易

从外国进口的商品。

```
进口贸易 = Σ(贸易伙伴 × 进口额 × 贸易关系)
```

##### 贸易关系

| 关系类型 | 关系系数 |
|----------|----------|
| 敌对 | 0.0 |
| 冷战 | 0.3 |
| 中立 | 0.6 |
| 友好 | 0.9 |
| 同盟 | 1.2 |

#### 战略储备

释放储备商品增加供给。

```
战略储备 = 储备释放 × 释放比例
```

##### 释放比例

| 紧急程度 | 释放比例 |
|----------|----------|
| 正常 | 0% |
| 小幅 | 10% |
| 中等 | 30% |
| 大幅 | 50% |
| 全面 | 80% |

#### 其他来源

捐赠、掠夺、发现等。

```
其他来源 = 捐赠 + 掠夺 + 发现
```

---

## 供给弹性

### 弹性定义

供给弹性衡量供给对价格变化的敏感度。

```
供给弹性 = 供给变化率 / 价格变化率
```

### 弹性分类

#### 缺乏弹性（<0.5）

供给对价格变化不敏感。

| 商品 | 供给弹性 | 特点 |
|------|----------|------|
| 农产品 | 0.4 | 受季节限制 |
| 矿产品 | 0.5 | 资源有限 |

#### 弹性一般（0.5-1.0）

供给对价格变化敏感度一般。

| 商品 | 供给弹性 | 特点 |
|------|----------|------|
| 工业品 | 0.8 | 可调整产能 |
| 轻工业品 | 0.9 | 灵活性高 |

#### 富有弹性（>1.0）

供给对价格变化很敏感。

| 商品 | 供给弹性 | 特点 |
|------|----------|------|
| 手工艺品 | 1.2 | 可快速调整 |
| 服务产品 | 1.5 | 灵活性极高 |

---

## 供给限制

### 生产能力限制

```
最大供给 = Σ(建筑最大产能 × 建筑数量)
```

### 资源限制

```
资源限制供给 = min(资源储量, 资源开采速度)
```

### 运输限制

```
运输限制供给 = min(生产供给, 运输能力)
```

### 政策限制

```
政策限制供给 = 基础供给 × (1 - 政策限制比例)
```

| 政策类型 | 限制比例 |
|----------|----------|
| 配额制度 | 10-30% |
| 许可制度 | 20-50% |
| 禁令制度 | 100% |

---

## 供需平衡

### 平衡点

供给=需求的点称为平衡点。

```
平衡价格 = f(需求, 供给)
```

### 供需比例

```
供需比例 = 需求 / 供给
```

| 供需比例 | 市场状态 | 价格趋势 |
|----------|----------|----------|
| <0.7 | 供给过剩 | 价格下跌 |
| 0.7-0.9 | 供给充足 | 价格稳定 |
| 0.9-1.1 | 供需平衡 | 价格稳定 |
| 1.1-1.3 | 需求旺盛 | 价格上涨 |
| >1.3 | 需求过热 | 价格大涨 |

### 平衡调整

#### 自动调整

市场自动调整到平衡点：

```
调整速度 = 基础速度 × 市场弹性
```

| 市场弹性 | 调整速度 | 调整周期 |
|----------|----------|----------|
| 高弹性 | 快速 | 1-3天 |
| 中弹性 | 中速 | 3-7天 |
| 低弹性 | 慢速 | 7-14天 |

#### 政策调整

政府可以通过政策影响平衡：

```
政策效果 = 政策强度 × 政策持续时间
```

---

## 供需异常

### 供给冲击

#### 供给短缺

```
供给短缺 = 预期供给 - 实际供给
```

原因：
- 自然灾害
- 战争冲突
- 资源枯竭

影响：
- 价格上涨
- 需求下降
- 替代品兴起

#### 供给过剩

```
供给过剩 = 实际供给 - 预期供给
```

原因：
- 技术进步
- 产能过剩
- 进口增加

影响：
- 价格下跌
- 需求上升
- 库存积压

### 需求冲击

#### 需求激增

```
需求激增 = 实际需求 - 预期需求
```

原因：
- 人口增长
- 经济繁荣
- 时尚潮流

影响：
- 价格上涨
- 供给增加
- 替代品兴起

#### 需求骤减

```
需求骤减 = 预期需求 - 实际需求
```

原因：
- 经济萧条
- 人口下降
- 替代品出现

影响：
- 价格下跌
- 供给减少
- 库存积压

---

## 供需数据示例

### 典型商品供需数据

| 商品 | 日均需求 | 日均供给 | 供需比例 | 价格状态 |
|------|----------|----------|----------|----------|
| 粮食 | 1000 | 1100 | 0.91 | 供给充足 |
| 钢材 | 500 | 450 | 1.11 | 需求旺盛 |
| 服装 | 300 | 350 | 0.86 | 供给充足 |
| 奢侈品 | 50 | 40 | 1.25 | 需求过热 |

### 供需弹性数据

| 商品 | 需求弹性 | 供给弹性 | 价格敏感度 |
|------|----------|----------|------------|
| 粮食 | 0.3 | 0.4 | 低 |
| 钢材 | 0.6 | 0.8 | 中 |
| 服装 | 0.8 | 1.0 | 中高 |
| 奢侈品 | 1.5 | 1.2 | 高 |

---

## 供需系统接口定义

### 供需管理器接口

```typescript
interface ISupplyDemandManager {
  calculateDemand(goodsId: string): number
  calculateSupply(goodsId: string): number

  getDemandElasticity(goodsId: string): number
  getSupplyElasticity(goodsId: string): number

  checkSupplyShortage(goodsId: string): boolean
  checkSupplySurplus(goodsId: string): boolean

  predictDemand(goodsId: string, days: number): number
  predictSupply(goodsId: string, days: number): number
}
```

---

## 供需系统性能优化

### 计算优化

1. **批量计算**：多个商品批量计算
2. **缓存结果**：缓存供需数据
3. **事件驱动**：只在变化时重新计算
4. **优先级队列**：重要商品优先处理

### 存储优化

1. **增量存储**：只存储变化部分
2. **定期清理**：清理历史数据
3. **压缩存储**：压缩供需记录
