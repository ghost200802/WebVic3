# 生产系统 - 资源系统

## 概述

资源系统管理游戏中所有可消耗和可生产的物质资源，是生产系统的基础。资源系统负责资源的存储、分配、追踪和限制。

---

## 资源分类

### 按来源分类

#### 自然资源

| 资源类型 | 获取方式 | 可再生性 | 所需地形 |
|----------|----------|----------|----------|
| 木材 | 伐木 | 可再生 | 森林 |
| 石材 | 采矿 | 不可再生 | 山地 |
| 铁矿 | 采矿 | 不可再生 | 铁矿床 |
| 铜矿 | 采矿 | 不可再生 | 铜矿床 |
| 锡矿 | 采矿 | 不可再生 | 锡矿床 |
| 煤炭 | 采矿 | 不可再生 | 煤矿床 |
| 石油 | 采油 | 不可再生 | 油田 |
| 铀矿 | 采矿 | 不可再生 | 铀矿床 |
| 稀土 | 采矿 | 不可再生 | 稀土矿床 |
| 土地资源 | 开发 | 可再生 | 平原 |

#### 生产资源

| 资源类型 | 生产方式 | 可存储性 | 存储期限 |
|----------|----------|----------|----------|
| 粮食 | 农田 | 可存储 | 有期限 |
| 肉类 | 牧场 | 可存储 | 有期限 |
| 布匹 | 纺织 | 可存储 | 长期 |
| 钢材 | 钢铁厂 | 可存储 | 长期 |
| 电子元件 | 电子厂 | 可存储 | 长期 |
| 电力 | 发电厂 | 不可存储 | 即时消耗 |

---

## 资源属性

### 资源基本属性

```typescript
interface Resource {
  id: string
  name: string
  type: ResourceType
  source: ResourceSource

  era: Era
  rarity: number

  basePrice: number
  priceElasticity: number

  storageRequired: boolean
  storageCapacity: number

  expirationTime?: number

  pollutionImpact: number

  transportable: boolean
  transportCost: number

  substituteResources?: string[]
}
```

### 属性说明

| 属性 | 说明 |
|------|------|
| `type` | 资源类型（原料、中间品、最终品等） |
| `source` | 资源来源（自然资源、生产资源） |
| `era` | 首次出现的时代 |
| `rarity` | 稀有度 0-1，1为最稀有 |
| `basePrice` | 基础价格 |
| `priceElasticity` | 价格弹性系数 |
| `storageRequired` | 是否需要存储 |
| `storageCapacity` | 单个仓库容量 |
| `expirationTime` | 过期时间（天） |
| `pollutionImpact` | 环境影响系数 |
| `transportable` | 是否可运输 |
| `transportCost` | 运输成本 |
| `substituteResources` | 替代资源列表 |

---

## 资源存储

### 存储设施

| 设施名称 | 容量 | 成本 | 时代 |
|----------|------|------|------|
| 简易储存 | 100单位 | 低 | 石器 |
| 粮仓 | 1000单位 | 中 | 青铜 |
| 仓库 | 5000单位 | 中 | 铁器 |
| 大型仓库 | 20000单位 | 高 | 工业 |
| 自动化仓库 | 100000单位 | 很高 | 信息 |

### 存储规则

#### 存储容量

```
最大存储 = Σ(仓库容量 × 仓库数量)
```

#### 存储效率

```
存储效率 = min(1, 实际存储 / 最大存储)
```

存储空间不足时：
- 新产出无法存储
- 存储效率下降
- 资源浪费

#### 存储成本

```
存储成本 = 单位成本 × 存储量 × 存储天数
```

### 资源过期

某些资源有保质期：

| 资源类型 | 保质期 | 过期效果 |
|----------|--------|----------|
| 粮食 | 180天 | 完全损失 |
| 肉类 | 90天 | 完全损失 |
| 蔬菜 | 30天 | 完全损失 |
| 药品 | 365天 | 效力下降 |

---

## 资源消耗

### 生产消耗

生产活动消耗资源：

```
消耗量 = 基础消耗 × 产出数量 × 消耗系数
```

### 生活消耗

人口日常生活消耗资源：

| 生活水平 | 每人每日粮食消耗 | 每人每日水资源 |
|----------|------------------|----------------|
| 0-20 | 0.5单位 | 1单位 |
| 20-40 | 0.8单位 | 1.5单位 |
| 40-60 | 1.0单位 | 2.0单位 |
| 60-80 | 1.5单位 | 3.0单位 |
| 80-100 | 2.0单位 | 4.0单位 |

### 军事消耗

军事活动消耗资源：

| 军事活动 | 消耗资源 | 消耗量 |
|----------|----------|--------|
| 士兵训练 | 粮食 | 5单位/人/天 |
| 战争消耗 | 武器、弹药 | 规模×系数 |
| 城市防御 | 建材、武器 | 规模×系数 |

---

## 资源限制

### 地形限制

某些资源只能在特定地形获取：

| 资源 | 地形要求 | 说明 |
|------|----------|------|
| 木材 | 森林 | 需伐木场 |
| 铁矿 | 铁矿床 | 需矿场 |
| 煤炭 | 煤矿床 | 需矿场 |
| 石油 | 油田 | 需油井 |
| 粮食 | 平原 | 需农田 |

### 资源枯竭

不可再生资源会枯竭：

```
当前储量 = 初始储量 - 已开采量
```

当储量 ≤ 10%时：
- 产出下降50%
- 开采成本翻倍
- 显示枯竭警告

当储量 = 0时：
- 完全无法开采
- 需寻找替代资源

### 资源稀缺度

```
稀缺度 = 1 - (当前储量 / 初始储量)
```

稀缺度影响：
- 价格上涨
- 战争风险增加
- 科技研发加速

---

## 资源替代

### 替代机制

当主要资源短缺时，可使用替代资源：

| 主要资源 | 替代资源 | 替代比例 | 效率损失 |
|----------|----------|----------|----------|
| 煤炭 | 木材 | 2:1 | 50% |
| 钢材 | 铁器 | 3:1 | 70% |
| 电力 | 人力 | 10:1 | 30% |
| 石油 | 生物燃料 | 1.5:1 | 80% |

### 替代条件

1. 替代资源必须可用
2. 替代资源充足
3. 替代科技已解锁
4. 满足生产要求

---

## 资源贸易

### 贸易类型

#### 内部贸易

同一文明内的资源调配：
- 成本：运输成本
- 时间：运输时间
- 限制：运力限制

#### 外部贸易

与其他文明的资源交换：
- 成本：运输 + 交易成本
- 时间：运输 + 谈判时间
- 限制：外交关系

### 贸易路线

```
贸易收益 = (目的地价格 - 出发地价格 - 运输成本) × 运输量
```

---

## 资源数据示例

### 资源总量示例

| 资源 | 初始储量 | 年开采量 | 可持续年数 | 时代 |
|------|----------|----------|------------|------|
| 木材 | ∞ | 可再生 | 永久 | 全部 |
| 铁矿 | 100万 | 1万 | 100 | 铁器+ |
| 煤炭 | 500万 | 5万 | 100 | 工业+ |
| 石油 | 200万 | 2万 | 100 | 工业+ |
| 铀矿 | 10万 | 100 | 1000 | 电气+ |
| 稀土 | 5万 | 50 | 1000 | 信息+ |

### 资源价格示例

| 资源 | 基础价格 | 价格波动 | 价格弹性 |
|------|----------|----------|----------|
| 粮食 | 10 | ±20% | 0.5 |
| 木材 | 5 | ±15% | 0.6 |
| 铁矿 | 20 | ±10% | 0.8 |
| 煤炭 | 15 | ±15% | 0.7 |
| 石油 | 30 | ±25% | 0.9 |
| 稀土 | 100 | ±30% | 1.2 |

---

## 资源管理与优化

### 库存管理

#### 安全库存

```
安全库存 = 日均消耗 × 安全系数
```

| 安全系数 | 安全天数 |
|----------|----------|
| 0.5 | 低风险 |
| 1.0 | 中等风险 |
| 2.0 | 高风险 |
| 3.0 | 极高风险 |

#### 库存优化

```
最优库存 = 日均消耗 × (交货期 + 安全缓冲)
```

### 资源配置

#### 配置原则

1. 优先保障关键资源
2. 平衡生产与消费
3. 预留应急储备
4. 考虑运输成本

#### 配置策略

| 策略 | 适用场景 | 优点 | 缺点 |
|------|----------|------|------|
| 即时生产 | 需求稳定 | 低库存成本 | 供应风险 |
| 安全库存 | 需求波动 | 风险可控 | 库存成本高 |
| 战略储备 | 关键资源 | 保障供应 | 资金占用大 |
| 贸易获取 | 本地稀缺 | 灵活性高 | 依赖外部 |

---

## 资源系统与其他系统的关系

### 与生产系统

- 生产消耗资源
- 资源限制生产
- 生产产出新资源

### 与市场系统

- 资源供需影响价格
- 价格引导资源配置
- 贸易平衡资源

### 与地形系统

- 地形决定资源分布
- 资源影响开发策略
- 领土扩张获取资源

### 与运输系统

- 资源运输需要运力
- 运力不足影响资源调配
- 运输成本影响经济效益

---

## 资源系统接口定义

### 资源管理器接口

```typescript
interface IResourceManager {
  getResourceAmount(resourceId: string): number
  addResource(resourceId: string, amount: number): void
  consumeResource(resourceId: string, amount: number): boolean

  getStorageCapacity(resourceId: string): number
  getStorageUsage(resourceId: string): number

  checkResourceAvailable(resourceId: string, amount: number): boolean

  findSubstitute(resourceId: string): string | null

  getResourcePrice(resourceId: string): number
}

interface ResourceStock {
  resourceId: string
  amount: number
  capacity: number
  lastUpdate: number
}
```

---

## 资源系统性能优化

### 计算优化

1. **批量更新**：多个资源批量更新
2. **事件驱动**：只在变化时重新计算
3. **缓存结果**：缓存频繁查询结果
4. **优先级队列**：关键资源优先处理

### 存储优化

1. **分片存储**：大规模资源分片管理
2. **增量更新**：只更新变化部分
3. **压缩存储**：历史数据压缩
4. **定期清理**：清理过期数据
